# ClaudeSDKMCP æ€§èƒ½ç›‘æ§è¯¦ç»†è¯´æ˜

## ğŸ” ç›‘æ§ç³»ç»Ÿæ¦‚è§ˆ

ClaudeSDKMCP v2.0.0 å†…ç½®äº†å®Œæ•´çš„å®æ—¶æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼Œæä¾›å¤šç»´åº¦çš„ç³»ç»Ÿè·Ÿè¸ªå’Œç»Ÿè®¡åˆ†æåŠŸèƒ½ã€‚

## ğŸ“Š ç›‘æ§ç»´åº¦

### 1. ç³»ç»Ÿèµ„æºç›‘æ§

#### å†…å­˜ç›‘æ§
```python
memory_info = self.process.memory_info()
metrics = {
    "memory_rss": memory_info.rss / 1024 / 1024,  # ç‰©ç†å†…å­˜ (MB)
    "memory_vms": memory_info.vms / 1024 / 1024,  # è™šæ‹Ÿå†…å­˜ (MB)
}
```

**ç›‘æ§æŒ‡æ ‡:**
- **RSS (Resident Set Size)**: å®é™…ç‰©ç†å†…å­˜ä½¿ç”¨é‡
- **VMS (Virtual Memory Size)**: è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡
- **å†…å­˜å¢é•¿è¶‹åŠ¿**: æ£€æµ‹å†…å­˜æ³„æ¼
- **å³°å€¼å†…å­˜**: æœ€å¤§å†…å­˜ä½¿ç”¨é‡

#### CPUç›‘æ§
```python
cpu_percent = self.process.cpu_percent()
```

**ç›‘æ§æŒ‡æ ‡:**
- **CPUä½¿ç”¨ç‡**: å®æ—¶CPUå ç”¨ç™¾åˆ†æ¯”
- **CPUå³°å€¼**: æœ€é«˜CPUä½¿ç”¨ç‡
- **CPUå¹³å‡å€¼**: è¿è¡ŒæœŸé—´å¹³å‡CPUä½¿ç”¨
- **CPUè¶‹åŠ¿**: CPUä½¿ç”¨å˜åŒ–è¶‹åŠ¿

#### ç³»ç»Ÿè¿è¡Œæ—¶é—´
```python
uptime = time.time() - self.start_time
```

### 2. ä¸“å®¶ç³»ç»Ÿç›‘æ§

#### ä¸“å®¶æ€§èƒ½ç»Ÿè®¡
```python
expert_metrics = {
    "total_requests": expert.total_requests,      # æ€»å¤„ç†è¯·æ±‚æ•°
    "success_rate": expert.success_rate,          # æˆåŠŸç‡
    "average_time": expert.average_processing_time, # å¹³å‡å¤„ç†æ—¶é—´
    "last_active": expert.last_active_time,       # æœ€åæ´»è·ƒæ—¶é—´
    "status": expert.status.value                 # ä¸“å®¶çŠ¶æ€
}
```

**ç›‘æ§çš„ä¸“å®¶:**
1. **ä»£ç æ¶æ„ä¸“å®¶** (code_architect_001)
2. **æ€§èƒ½ä¼˜åŒ–ä¸“å®¶** (performance_optimizer_001)  
3. **APIè®¾è®¡ä¸“å®¶** (api_designer_001)
4. **å®‰å…¨åˆ†æä¸“å®¶** (security_analyst_001)
5. **æ•°æ®åº“ä¸“å®¶** (database_expert_001)

#### ä¸“å®¶è´Ÿè½½åˆ†æ
- **è¯·æ±‚åˆ†å¸ƒ**: å„ä¸“å®¶å¤„ç†è¯·æ±‚çš„åˆ†å¸ƒæƒ…å†µ
- **è´Ÿè½½å‡è¡¡**: ä¸“å®¶é—´è´Ÿè½½æ˜¯å¦å‡è¡¡
- **ä¸“å®¶æ•ˆç‡**: å„ä¸“å®¶çš„å¤„ç†æ•ˆç‡å¯¹æ¯”
- **ä¸“å®¶å¯ç”¨æ€§**: ä¸“å®¶çš„åœ¨çº¿çŠ¶æ€ç›‘æ§

### 3. æ“ä½œå¤„ç†å™¨ç›‘æ§

#### æ“ä½œæ‰§è¡Œç»Ÿè®¡
```python
operation_stats = {
    "total_operations": 38,                    # æ€»æ“ä½œæ•°
    "executed_operations": len(executed_ops),  # å·²æ‰§è¡Œæ“ä½œæ•°
    "success_rate": success_count / total_count, # æ“ä½œæˆåŠŸç‡
    "average_time": total_time / total_count   # å¹³å‡æ‰§è¡Œæ—¶é—´
}
```

**38ä¸ªæ“ä½œå¤„ç†å™¨åˆ†ç±»ç›‘æ§:**
- **ä»£ç åˆ†æç±»** (8ä¸ª): è¯­æ³•ã€è¯­ä¹‰ã€å¤æ‚åº¦ç­‰
- **æ¶æ„è®¾è®¡ç±»** (8ä¸ª): æ¶æ„å®¡æŸ¥ã€è®¾è®¡æ¨¡å¼ç­‰
- **æ€§èƒ½ä¼˜åŒ–ç±»** (8ä¸ª): æ€§èƒ½åˆ†æã€ç“¶é¢ˆè¯†åˆ«ç­‰
- **APIè®¾è®¡ç±»** (6ä¸ª): APIè®¾è®¡ã€RESTåˆ†æç­‰
- **å®‰å…¨åˆ†æç±»** (5ä¸ª): æ¼æ´æ‰«æã€å®‰å…¨å®¡è®¡ç­‰
- **æ•°æ®åº“ç±»** (3ä¸ª): æ•°æ®åº“è®¾è®¡ã€æŸ¥è¯¢ä¼˜åŒ–ç­‰

### 4. è¯·æ±‚å¤„ç†ç›‘æ§

#### è¯·æ±‚ç»Ÿè®¡
```python
request_metrics = {
    "total_requests": self.total_requests,     # æ€»è¯·æ±‚æ•°
    "successful_requests": self.success_count, # æˆåŠŸè¯·æ±‚æ•°
    "failed_requests": self.error_count,       # å¤±è´¥è¯·æ±‚æ•°
    "average_processing_time": self.avg_time,  # å¹³å‡å¤„ç†æ—¶é—´
    "requests_per_second": self.rps           # æ¯ç§’è¯·æ±‚æ•°
}
```

#### å¹¶å‘å¤„ç†ç›‘æ§
- **å¹¶å‘è¯·æ±‚æ•°**: åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°é‡
- **é˜Ÿåˆ—é•¿åº¦**: ç­‰å¾…å¤„ç†çš„è¯·æ±‚é˜Ÿåˆ—
- **å“åº”æ—¶é—´**: è¯·æ±‚å“åº”æ—¶é—´åˆ†å¸ƒ
- **ååé‡**: ç³»ç»Ÿå¤„ç†èƒ½åŠ›

## ğŸš€ ç›‘æ§åŠŸèƒ½å®ç°

### 1. å®æ—¶ç›‘æ§ç±»
```python
class PerformanceMonitor:
    def __init__(self, claude_sdk: ClaudeSDKMCP):
        self.claude_sdk = claude_sdk
        self.monitoring_data = []
        self.start_time = time.time()
        self.process = psutil.Process(os.getpid())
    
    def capture_performance_snapshot(self) -> Dict[str, Any]:
        """æ•è·æ€§èƒ½å¿«ç…§"""
        return {
            "system": self.capture_system_metrics(),
            "experts": self.capture_expert_metrics(),
            "timestamp": time.strftime("%Y-%m-%d %H:%M:%S")
        }
```

### 2. ç³»ç»ŸæŒ‡æ ‡æ•è·
```python
def capture_system_metrics(self) -> Dict[str, Any]:
    """æ•è·ç³»ç»ŸæŒ‡æ ‡"""
    memory_info = self.process.memory_info()
    cpu_percent = self.process.cpu_percent()
    
    return {
        "timestamp": time.time(),
        "memory_rss": memory_info.rss / 1024 / 1024,  # MB
        "memory_vms": memory_info.vms / 1024 / 1024,  # MB
        "cpu_percent": cpu_percent,
        "uptime": time.time() - self.start_time
    }
```

### 3. ä¸“å®¶æŒ‡æ ‡æ•è·
```python
def capture_expert_metrics(self) -> Dict[str, Any]:
    """æ•è·ä¸“å®¶ç³»ç»ŸæŒ‡æ ‡"""
    stats = self.claude_sdk.get_statistics()
    
    expert_metrics = {}
    for expert_id, expert_stats in stats.get('expert_statistics', {}).items():
        expert_metrics[expert_id] = {
            "name": expert_stats['name'],
            "total_requests": expert_stats['total_requests'],
            "success_rate": expert_stats['success_rate'],
            "status": expert_stats['status']
        }
    
    return {
        "total_requests": stats['total_requests'],
        "total_experts": stats['total_experts'],
        "operation_handlers": stats['operation_handlers'],
        "experts": expert_metrics
    }
```

## ğŸ“ˆ ç›‘æ§æ¨¡å¼

### 1. å®æ—¶ç›‘æ§æ¨¡å¼
```bash
python performance_monitor_demo.py
# é€‰æ‹©: 1. å®æ—¶ç›‘æ§ (æŒç»­æ˜¾ç¤º)
```

**ç‰¹ç‚¹:**
- æŒç»­åˆ·æ–°æ˜¾ç¤º
- å®æ—¶ç³»ç»ŸçŠ¶æ€
- åŠ¨æ€å›¾è¡¨æ›´æ–°
- å³æ—¶å‘Šè­¦æé†’

**æ˜¾ç¤ºå†…å®¹:**
```
ğŸ” ClaudeSDKMCP å®æ—¶æ€§èƒ½ç›‘æ§
============================================================
â° æ—¶é—´: 2025-06-27 11:00:00
â±ï¸ è¿è¡Œæ—¶é—´: 120.5s

ğŸ’¾ ç³»ç»Ÿèµ„æº:
  å†…å­˜ä½¿ç”¨: 33.2 MB
  è™šæ‹Ÿå†…å­˜: 45.8 MB
  CPUä½¿ç”¨ç‡: 15.3%

ğŸ‘¨â€ğŸ’¼ ä¸“å®¶ç³»ç»Ÿ:
  æ€»è¯·æ±‚æ•°: 25
  ä¸“å®¶æ•°é‡: 5
  æ“ä½œå¤„ç†å™¨: 38

ğŸ“Š ä¸“å®¶è¯¦æƒ…:
  ğŸŸ¢ ä»£ç æ¶æ„ä¸“å®¶: 15 è¯·æ±‚, æˆåŠŸç‡ 100.0%
  ğŸŸ¢ æ€§èƒ½ä¼˜åŒ–ä¸“å®¶: 5 è¯·æ±‚, æˆåŠŸç‡ 100.0%
  ğŸŸ¢ APIè®¾è®¡ä¸“å®¶: 3 è¯·æ±‚, æˆåŠŸç‡ 100.0%
  ğŸŸ¢ å®‰å…¨åˆ†æä¸“å®¶: 2 è¯·æ±‚, æˆåŠŸç‡ 100.0%
  ğŸŸ¢ æ•°æ®åº“ä¸“å®¶: 0 è¯·æ±‚, æˆåŠŸç‡ 0.0%

ğŸ’¡ æç¤º: æŒ‰ Ctrl+C åœæ­¢ç›‘æ§å¹¶ç”ŸæˆæŠ¥å‘Š
```

### 2. è´Ÿè½½æµ‹è¯•ç›‘æ§
```bash
python performance_monitor_demo.py
# é€‰æ‹©: 2. è´Ÿè½½æµ‹è¯•ç›‘æ§
```

**æµ‹è¯•åœºæ™¯:**
```python
test_requests = [
    ("åˆ†æPythonä»£ç æ€§èƒ½", {"code": "def test(): pass", "language": "python"}),
    ("æ£€æŸ¥å®‰å…¨æ¼æ´", {"code": "sql = f'SELECT * FROM users WHERE id = {user_id}'", "language": "python"}),
    ("ä¼˜åŒ–ç®—æ³•", {"code": "for i in range(1000): result = i * i", "language": "python"}),
    ("APIè®¾è®¡å®¡æŸ¥", {"api": "REST API", "context": "å¾®æœåŠ¡"}),
    ("æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–", {"query": "SELECT * FROM large_table", "context": "æ€§èƒ½ä¼˜åŒ–"})
]
```

**ç›‘æ§è¾“å‡º:**
```
ğŸš€ å¯åŠ¨å¸¦è´Ÿè½½çš„æ€§èƒ½ç›‘æ§æ¼”ç¤º
ğŸ“‹ æ‰§è¡Œæµ‹è¯•è´Ÿè½½...
ğŸ”„ å¼€å§‹å¤„ç†è¯·æ±‚...
  å¤„ç†è¯·æ±‚ 1/5: åˆ†æPythonä»£ç æ€§èƒ½
    âœ… å®Œæˆ - æ—¶é—´: 0.06s, ä¸“å®¶: code_architect_001
    ğŸ“Š å†…å­˜: 32.9MB, æ€»è¯·æ±‚: 1
  å¤„ç†è¯·æ±‚ 2/5: æ£€æŸ¥å®‰å…¨æ¼æ´
    âœ… å®Œæˆ - æ—¶é—´: 0.07s, ä¸“å®¶: security_analyst_001
    ğŸ“Š å†…å­˜: 33.0MB, æ€»è¯·æ±‚: 2
  ...
```

### 3. å¿«ç…§ç›‘æ§æ¨¡å¼
```bash
python performance_monitor_demo.py
# é€‰æ‹©: 3. å¿«ç…§æ¨¡å¼
```

**å¿«ç…§å†…å®¹:**
```json
{
  "system": {
    "timestamp": 1703664000.0,
    "memory_rss": 33.2,
    "memory_vms": 45.8,
    "cpu_percent": 15.3,
    "uptime": 120.5
  },
  "experts": {
    "total_requests": 25,
    "total_experts": 5,
    "operation_handlers": 38,
    "experts": {
      "code_architect_001": {
        "name": "ä»£ç æ¶æ„ä¸“å®¶",
        "total_requests": 15,
        "success_rate": 1.0,
        "status": "active"
      }
    }
  },
  "timestamp": "2025-06-27 11:00:00"
}
```

## ğŸ“‹ ç›‘æ§æŠ¥å‘Š

### 1. ç›‘æ§æŠ¥å‘Šç»“æ„
```json
{
  "monitoring_summary": {
    "total_snapshots": 100,
    "monitoring_duration": 300.5,
    "start_time": "2025-06-27 11:00:00",
    "end_time": "2025-06-27 11:05:00"
  },
  "system_performance": {
    "memory_usage_mb": {
      "average": 33.2,
      "maximum": 35.1,
      "minimum": 32.8,
      "trend": "stable"
    },
    "cpu_usage_percent": {
      "average": 15.3,
      "maximum": 28.7,
      "trend": "decreasing"
    }
  },
  "expert_performance": {
    "total_requests": 150,
    "total_experts": 5,
    "operation_handlers": 38,
    "expert_distribution": {
      "code_architect_001": 60,
      "performance_optimizer_001": 30,
      "api_designer_001": 25,
      "security_analyst_001": 20,
      "database_expert_001": 15
    }
  },
  "performance_trends": {
    "memory_trend": "stable",
    "cpu_trend": "decreasing",
    "request_trend": "increasing",
    "success_rate_trend": "stable"
  },
  "recommendations": [
    "ç³»ç»Ÿæ€§èƒ½è‰¯å¥½ï¼Œæ— éœ€ç‰¹åˆ«ä¼˜åŒ–",
    "ä¸“å®¶è´Ÿè½½åˆ†å¸ƒåˆç†",
    "å»ºè®®ç»§ç»­ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ"
  ]
}
```

### 2. æ€§èƒ½å»ºè®®ç”Ÿæˆ
```python
def generate_performance_recommendations(self, avg_memory: float, avg_cpu: float, expert_stats: Dict) -> List[str]:
    """ç”Ÿæˆæ€§èƒ½å»ºè®®"""
    recommendations = []
    
    # å†…å­˜åˆ†æ
    if avg_memory > 100:
        recommendations.append("å†…å­˜ä½¿ç”¨è¾ƒé«˜ï¼Œå»ºè®®ä¼˜åŒ–å†…å­˜ç®¡ç†")
    elif avg_memory < 20:
        recommendations.append("å†…å­˜ä½¿ç”¨æ•ˆç‡è‰¯å¥½")
    
    # CPUåˆ†æ
    if avg_cpu > 50:
        recommendations.append("CPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œå»ºè®®ä¼˜åŒ–ç®—æ³•æ€§èƒ½")
    elif avg_cpu < 10:
        recommendations.append("CPUä½¿ç”¨æ•ˆç‡è‰¯å¥½")
    
    # ä¸“å®¶è´Ÿè½½åˆ†æ
    expert_requests = [exp['total_requests'] for exp in expert_stats['experts'].values()]
    if expert_requests and max(expert_requests) > 0:
        load_balance = max(expert_requests) / sum(expert_requests)
        if load_balance > 0.8:
            recommendations.append("ä¸“å®¶ä½¿ç”¨ä¸å‡è¡¡ï¼Œå»ºè®®ä¼˜åŒ–è´Ÿè½½åˆ†é…")
        else:
            recommendations.append("ä¸“å®¶è´Ÿè½½åˆ†å¸ƒåˆç†")
    
    return recommendations
```

## ğŸ”§ ç›‘æ§é…ç½®

### 1. ç›‘æ§å‚æ•°é…ç½®
```python
@dataclass
class MonitoringConfig:
    """ç›‘æ§é…ç½®"""
    enable_monitoring: bool = True
    monitoring_interval: float = 1.0
    max_snapshots: int = 1000
    alert_memory_threshold: float = 100.0  # MB
    alert_cpu_threshold: float = 80.0      # %
    enable_alerts: bool = True
    save_reports: bool = True
    report_format: str = "json"
```

### 2. å‘Šè­¦ç³»ç»Ÿ
```python
class AlertSystem:
    """å‘Šè­¦ç³»ç»Ÿ"""
    
    def check_alerts(self, metrics: Dict[str, Any]):
        """æ£€æŸ¥å‘Šè­¦æ¡ä»¶"""
        alerts = []
        
        # å†…å­˜å‘Šè­¦
        if metrics['system']['memory_rss'] > self.config.alert_memory_threshold:
            alerts.append({
                "type": "memory",
                "level": "warning",
                "message": f"å†…å­˜ä½¿ç”¨è¿‡é«˜: {metrics['system']['memory_rss']:.1f}MB"
            })
        
        # CPUå‘Šè­¦
        if metrics['system']['cpu_percent'] > self.config.alert_cpu_threshold:
            alerts.append({
                "type": "cpu",
                "level": "warning", 
                "message": f"CPUä½¿ç”¨ç‡è¿‡é«˜: {metrics['system']['cpu_percent']:.1f}%"
            })
        
        return alerts
```

## ğŸ“Š ç›‘æ§é›†æˆ

### 1. CLIé›†æˆ
```bash
# æŸ¥çœ‹å®æ—¶ç»Ÿè®¡
python cli.py stats

# å¯åŠ¨ç›‘æ§
python cli.py monitor --mode realtime

# ç”ŸæˆæŠ¥å‘Š
python cli.py monitor --mode report --duration 300
```

### 2. APIé›†æˆ
```python
# è·å–æ€§èƒ½æŒ‡æ ‡
async def get_performance_metrics():
    claude_sdk = ClaudeSDKMCP()
    stats = claude_sdk.get_statistics()
    return stats

# å¯åŠ¨ç›‘æ§
async def start_monitoring():
    claude_sdk = ClaudeSDKMCP()
    monitor = PerformanceMonitor(claude_sdk)
    monitor.start_monitoring(interval=2.0)
```

### 3. Webç•Œé¢é›†æˆ
```python
from flask import Flask, jsonify
app = Flask(__name__)

@app.route('/api/metrics')
def get_metrics():
    """è·å–å®æ—¶æŒ‡æ ‡"""
    monitor = PerformanceMonitor(claude_sdk)
    snapshot = monitor.capture_performance_snapshot()
    return jsonify(snapshot)

@app.route('/api/stats')
def get_stats():
    """è·å–ç»Ÿè®¡ä¿¡æ¯"""
    stats = claude_sdk.get_statistics()
    return jsonify(stats)
```

## ğŸ¯ ç›‘æ§æœ€ä½³å®è·µ

### 1. ç›‘æ§ç­–ç•¥
- **æŒç»­ç›‘æ§**: ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨æŒç»­ç›‘æ§
- **å®šæœŸæŠ¥å‘Š**: æ¯æ—¥/æ¯å‘¨ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
- **å‘Šè­¦è®¾ç½®**: è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- **è¶‹åŠ¿åˆ†æ**: å…³æ³¨é•¿æœŸæ€§èƒ½è¶‹åŠ¿

### 2. æ€§èƒ½ä¼˜åŒ–
- **å†…å­˜ä¼˜åŒ–**: ç›‘æ§å†…å­˜æ³„æ¼ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æº
- **CPUä¼˜åŒ–**: è¯†åˆ«CPUå¯†é›†å‹æ“ä½œï¼Œä¼˜åŒ–ç®—æ³•
- **è´Ÿè½½å‡è¡¡**: ç¡®ä¿ä¸“å®¶è´Ÿè½½åˆ†å¸ƒå‡åŒ€
- **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—

### 3. æ•…éšœæ’æŸ¥
- **æ€§èƒ½ä¸‹é™**: é€šè¿‡ç›‘æ§æ•°æ®å®šä½æ€§èƒ½ç“¶é¢ˆ
- **å†…å­˜æ³„æ¼**: ç›‘æ§å†…å­˜å¢é•¿è¶‹åŠ¿
- **ä¸“å®¶æ•…éšœ**: ç›‘æ§ä¸“å®¶çŠ¶æ€å’ŒæˆåŠŸç‡
- **ç³»ç»Ÿå¼‚å¸¸**: å®æ—¶å‘Šè­¦å’Œæ—¥å¿—åˆ†æ

## ğŸ‰ ç›‘æ§ç³»ç»Ÿä¼˜åŠ¿

âœ… **å…¨é¢ç›‘æ§** - ç³»ç»Ÿã€ä¸“å®¶ã€æ“ä½œå¤šç»´åº¦ç›‘æ§  
âœ… **å®æ—¶è·Ÿè¸ª** - æ¯«ç§’çº§æ€§èƒ½æ•°æ®æ•è·  
âœ… **æ™ºèƒ½åˆ†æ** - è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½å»ºè®®  
âœ… **çµæ´»é…ç½®** - å¯é…ç½®çš„ç›‘æ§å‚æ•°  
âœ… **å‘Šè­¦æœºåˆ¶** - åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜  
âœ… **æŠ¥å‘Šç”Ÿæˆ** - è¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š  
âœ… **è¶‹åŠ¿åˆ†æ** - é•¿æœŸæ€§èƒ½è¶‹åŠ¿è·Ÿè¸ª  
âœ… **æ˜“äºé›†æˆ** - æ”¯æŒCLIã€APIã€Webé›†æˆ  

ClaudeSDKMCPçš„æ€§èƒ½ç›‘æ§ç³»ç»Ÿä¸ºç³»ç»Ÿè¿ç»´å’Œæ€§èƒ½ä¼˜åŒ–æä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼

