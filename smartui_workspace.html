<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartUI å·¥ä½œåŒº - AI-First IDE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Monaco Editor CDN -->
    <script src="https://unpkg.com/monaco-editor@0.52.2/min/vs/loader.js"></script>
    <style>
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .tab-inactive {
            background: #374151;
            color: #9ca3af;
        }
        .terminal-output {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            color: #00ff00;
        }
        .file-item:hover {
            background-color: #374151;
        }
        .quick-action-btn {
            transition: all 0.2s ease;
        }
        .quick-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .status-indicator {
            animation: pulse 2s infinite;
        }
        /* Monaco Editor æ ·å¼ */
        #monaco-editor-container {
            height: 400px;
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl font-bold">SmartUI + SmartInvention Flow MCP</h1>
            <div class="flex space-x-2">
                <span class="px-3 py-1 bg-green-600 text-white rounded-full text-sm">âœ“ è‡ªåŠ¨ç™»å½•æˆåŠŸ</span>
                <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-sm">SmartInvention MCP å¯ç”¨</span>
                <span class="px-3 py-1 bg-purple-600 text-white rounded-full text-sm">Github å·²è¿æ¥</span>
                <span id="modeIndicator" class="px-3 py-1 bg-gray-600 text-white rounded-full text-sm">å¤„ç†æ¨¡å¼ï¼šğŸŒ äº‘ç«¯ç‰ˆæœ¬</span>
                <button id="toggleModeBtn" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full text-sm transition-colors">åˆ‡æ¢åˆ°æœ¬åœ°</button>
            </div>
        </div>
        <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-300">alexchuang650730/aicore0624 é¡¹ç›® | 4 ä¸ªæ–‡ä»¶</span>
            <button id="logoutBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <div class="flex h-screen">
        <!-- å·¦ä¾§é¡¹ç›®æµè§ˆå™¨ -->
        <div class="w-64 bg-gray-800 border-r border-gray-700 p-4">
            <h3 class="text-lg font-semibold mb-4">ğŸ“ é¡¹ç›®æµè§ˆå™¨</h3>
            <div class="text-sm text-gray-400 mb-2">alexchuang650730/aicore0624</div>
            
            <!-- æ–‡ä»¶åˆ—è¡¨ -->
            <div class="space-y-1 mb-4">
                <div class="file-item p-2 rounded cursor-pointer text-gray-300 hover:bg-gray-700" data-file="PowerAutomation_local">
                    ğŸ“ PowerAutomation_local
                </div>
                <div class="file-item p-2 rounded cursor-pointer text-gray-300 hover:bg-gray-700" data-file="powerautomation_web">
                    ğŸ“ powerautomation_web  
                </div>
                <div class="file-item p-2 rounded cursor-pointer text-gray-300 hover:bg-gray-700" data-file="README.md">
                    ğŸ“„ README.md
                </div>
                <div class="file-item p-2 rounded cursor-pointer text-gray-300 hover:bg-gray-700" data-file="package.json">
                    ğŸ“„ package.json
                </div>
            </div>

            <!-- éƒ¨ç½²çŠ¶æ€ -->
            <div class="border border-green-600 rounded-lg p-3 mt-4">
                <h4 class="text-green-400 font-semibold mb-2">âœ… ä¸€é”®éƒ¨ç½²çŠ¶æ€</h4>
                <div class="space-y-1 text-sm">
                    <div class="text-green-400">âœ“ PowerAutomation_local è‡ªåŠ¨æˆåŠŸ</div>
                    <div class="text-green-400">âœ“ PowerAutomation_web è‡ªåŠ¨æˆåŠŸ</div>
                    <div class="text-green-400">âœ“ SmartUI å·¥ä½œåŒºå·²å°±ç»ª</div>
                </div>
            </div>
        </div>

        <!-- ä¸»å·¥ä½œåŒº -->
        <div class="flex-1 flex flex-col">
            <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
            <div class="bg-gray-800 border-b border-gray-700 p-2">
                <div class="flex space-x-1">
                    <button class="tab-btn px-4 py-2 rounded-t-lg tab-active" data-tab="cascade">
                        âœ¨ Cascade åä½œ
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg tab-inactive" data-tab="composer">
                        ğŸ’» Composer
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg tab-inactive" data-tab="preview">
                        ğŸ‘ï¸ å®æ—¶é¢„è§ˆ
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg tab-inactive" data-tab="terminal">
                        ğŸ–¥ï¸ ç»ˆç«¯æœº
                    </button>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µå†…å®¹ -->
            <div class="flex-1 p-4">
                <!-- Cascade åä½œæ ‡ç­¾é¡µ -->
                <div id="cascade-tab" class="tab-content">
                    <div class="bg-gray-800 rounded-lg p-6 h-full">
                        <div class="flex items-center mb-4">
                            <h2 class="text-2xl font-bold text-blue-400">ğŸ¤– æ™ºèƒ½æŸ¥è¯¢</h2>
                        </div>
                        
                        <!-- å¯¹è¯å†å²åŒºåŸŸ -->
                        <div id="chatHistory" class="bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto mb-4">
                            <div class="bg-blue-900 border border-blue-600 rounded-lg p-4 mb-4">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">ğŸ‰</span>
                                    <h3 class="text-lg font-semibold text-blue-300">æ¬¢è¿ä½¿ç”¨ SmartUI å·¥ä½œåŒºï¼</h3>
                                </div>
                                <p class="text-blue-200 mb-2">æ‚¨å·²æˆåŠŸé€šè¿‡è‡ªåŠ¨ç™»å½•è¿›å…¥å·¥ä½œåŒºã€‚å½“å‰è¿è¡Œæ¨¡å¼ï¼š<span id="currentMode">äº‘ç«¯ç‰ˆæœ¬</span></p>
                                <p class="text-blue-200">æ‰€æœ‰å¿…è¦çš„æœåŠ¡å·²è‡ªåŠ¨å¯åŠ¨ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨å„é¡¹åŠŸèƒ½ã€‚</p>
                            </div>
                            
                            <div class="text-center text-gray-400 mt-8">
                                <div class="text-4xl mb-2">ğŸš€</div>
                                <p>è¾“å…¥æ‚¨çš„å¼€å‘éœ€æ±‚ï¼ŒAIå°†ä¸ºæ‚¨æä¾›è¯¦ç»†çš„æŠ€æœ¯æ–¹æ¡ˆ</p>
                                <p class="text-sm mt-2">å’Œä»£ç ç¤ºä¾‹</p>
                            </div>
                        </div>

                        <!-- å›ºå®šåœ¨åº•éƒ¨çš„å¯¹è¯è¾“å…¥æ¡† -->
                        <div class="flex space-x-2">
                            <input 
                                id="queryInput" 
                                type="text" 
                                placeholder="è¾“å…¥æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæˆ‘è¦å¼€å‘è´ªåƒè›‡æ¸¸æˆ..." 
                                class="flex-1 px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
                            >
                            <button 
                                id="queryBtn" 
                                class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-semibold"
                            >
                                æŸ¥è¯¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Composer æ ‡ç­¾é¡µ -->
                <div id="composer-tab" class="tab-content hidden">
                    <div class="bg-gray-800 rounded-lg p-4 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold">ğŸ’» Monaco Editor + LSP</h2>
                            <span id="editingFile" class="text-sm text-gray-400">æ­£åœ¨ç¼–è¾‘: æœªé€‰æ‹©æ–‡ä»¶</span>
                        </div>
                        <div class="h-full">
                            <!-- Monaco Editor å®¹å™¨ -->
                            <div id="monaco-editor-container"></div>
                            <div class="flex space-x-2 mt-4">
                                <button id="saveFileBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors">ä¿å­˜æ–‡ä»¶</button>
                                <button id="formatCodeBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">æ ¼å¼åŒ–ä»£ç </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å®æ—¶é¢„è§ˆæ ‡ç­¾é¡µ -->
                <div id="preview-tab" class="tab-content hidden">
                    <div class="bg-gray-800 rounded-lg p-4 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold">ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h2>
                            <button id="refreshPreviewBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">åˆ·æ–°é¢„è§ˆ</button>
                        </div>
                        <div id="previewContent" class="bg-white rounded-lg h-full p-4 text-black overflow-auto">
                            <div class="text-center py-20">
                                <h3 class="text-2xl font-bold text-blue-600 mb-4">ğŸš€ SmartUI å®æ—¶é¢„è§ˆ</h3>
                                <p class="text-gray-600 mb-4">è¿™é‡Œå°†æ˜¾ç¤ºæ‚¨çš„é¡¹ç›®é¢„è§ˆæ•ˆæœ</p>
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg max-w-md mx-auto">
                                    <h4 class="text-lg font-semibold mb-2">ç¤ºä¾‹é¢„è§ˆå†…å®¹</h4>
                                    <p>HTMLã€CSS å’Œ JavaScript çš„æ¸²æŸ“æ•ˆæœå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç»ˆç«¯æœºæ ‡ç­¾é¡µ -->
                <div id="terminal-tab" class="tab-content hidden">
                    <div class="bg-gray-800 rounded-lg p-4 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold">ğŸ–¥ï¸ æ™ºèƒ½ç»ˆç«¯æœº</h2>
                            <div class="flex items-center space-x-2">
                                <span id="platformStatus" class="px-2 py-1 bg-green-600 text-white rounded text-sm">å·²æ£€æµ‹ Linux</span>
                                <span id="mcpStatus" class="px-2 py-1 bg-blue-600 text-white rounded text-sm">MCP å·²è¿æ¥</span>
                            </div>
                        </div>
                        
                        <div class="bg-black rounded-lg p-4 h-4/5 overflow-y-auto font-mono text-sm">
                            <div id="terminalOutput" class="terminal-output">
<span class="text-green-400">SmartUI Terminal v1.0.0 - æ™ºèƒ½å¹³å°é€‚é…</span>
<span class="text-blue-400">æ­£åœ¨æ£€æµ‹å¹³å°... ğŸ” æ£€æµ‹åˆ°è¿è¡Œç¯å¢ƒ: <span id="detectedPlatform">Linux</span></span>
<span class="text-green-400" id="platformConnection">âœ… å¹³å°æ£€æµ‹æˆåŠŸ: Linux â†’ è¿æ¥åˆ° linux_terminal</span>
<span class="text-yellow-400" id="mcpConnection">âš ï¸ æ­£åœ¨è¿æ¥åˆ° <span id="mcpTarget">linux_terminal</span>...</span>
<span class="text-green-400" id="mcpSuccess">âœ… æœ¬åœ°Linux MCPè¿æ¥æˆåŠŸ ğŸ”§ æœ¬åœ°ç»ˆç«¯æœåŠ¡å·²å¯åŠ¨</span>
<span class="text-white">user@localhost:aicore0624$ </span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <input 
                                id="terminalInput" 
                                type="text" 
                                placeholder="è¾“å…¥å‘½ä»¤..." 
                                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white font-mono focus:outline-none focus:border-blue-500"
                            >
                            <div class="text-xs text-gray-400 mt-1">
                                ğŸ’¡ æç¤º: æ”¯æŒæ ‡å‡†Unixå‘½ä»¤ï¼Œè¾“å…¥ 'clear' æ¸…å±
                                <br>ğŸ–¥ï¸ å¹³å°è‡ªé€‚åº”: æ ¹æ®ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹© WSL/macOS/Unix ç»ˆç«¯
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§å¿«é€Ÿæ“ä½œé¢æ¿ -->
        <div class="w-80 bg-gray-800 border-l border-gray-700 p-4">
            <div class="flex items-center mb-4">
                <span class="text-xl mr-2">âš¡</span>
                <h3 class="text-lg font-semibold">å¿«é€Ÿæ“ä½œ</h3>
            </div>
            
            <div class="space-y-3 mb-6">
                <button id="openFolderBtn" class="quick-action-btn w-full p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center space-x-2 transition-all">
                    <span class="text-lg">ğŸ“</span>
                    <span class="font-medium">æ‰“å¼€æ–‡ä»¶å¤¹</span>
                </button>
                <button id="cloneRepoBtn" class="quick-action-btn w-full p-3 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center space-x-2 transition-all">
                    <span class="text-lg">ğŸ”„</span>
                    <span class="font-medium">å…‹éš†Gitä»“åº“</span>
                </button>
                <button id="connectRemoteBtn" class="quick-action-btn w-full p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center justify-center space-x-2 transition-all">
                    <span class="text-lg">ğŸŒ</span>
                    <span class="font-medium">è¿æ¥è¿œç¨‹ä¸»æœº</span>
                </button>
                <button id="newFileBtn" class="quick-action-btn w-full p-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg flex items-center justify-center space-x-2 transition-all">
                    <span class="text-lg">ğŸ“„</span>
                    <span class="font-medium">æ–°å»ºæ–‡ä»¶</span>
                </button>
            </div>

            <div class="bg-gray-900 rounded-lg p-4">
                <h4 class="font-semibold mb-3">æ“ä½œçŠ¶æ€:</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center text-green-400">
                        <span class="status-indicator mr-2">âœ“</span>
                        <span>è‡ªåŠ¨ç™»å½•å®Œæˆ</span>
                    </div>
                    <div class="flex items-center text-green-400">
                        <span class="status-indicator mr-2">âœ“</span>
                        <span>æœåŠ¡å·²å¯åŠ¨</span>
                    </div>
                    <div class="text-gray-400">ç­‰å¾…ç”¨æˆ·æ“ä½œ...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€ç®¡ç†
        let currentMode = 'cloud'; // 'cloud' æˆ– 'local'
        let currentPlatform = 'linux'; // 'linux', 'mac', 'windows'
        let mcpConnected = false;
        let monacoEditor = null; // Monaco Editor å®ä¾‹

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initMonacoEditor(); // åˆå§‹åŒ– Monaco Editor
            detectPlatform();
            setupEventListeners();
        });

        function initializeApp() {
            // æ£€æµ‹å½“å‰ç¯å¢ƒ
            detectEnvironment();
            updateModeDisplay();
            updateTerminalDisplay();
        }

        // åˆå§‹åŒ–Monaco Editor
        function initMonacoEditor() {
            require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.52.2/min/vs' } });
            require(['vs/editor/editor.main'], function () {
                monacoEditor = monaco.editor.create(document.getElementById('monaco-editor-container'), {
                    value: '// æ¬¢è¿ä½¿ç”¨ Monaco Editor + LSP\n// é€‰æ‹©å·¦ä¾§æ–‡ä»¶å¼€å§‹ç¼–è¾‘ï¼Œæˆ–è€…åœ¨è¿™é‡Œç›´æ¥ç¼–å†™ä»£ç \n\nfunction hello() {\n    console.log("Hello from Monaco Editor!");\n}\n',
                    language: 'javascript',
                    theme: 'vs-dark',
                    fontSize: 14,
                    minimap: { enabled: true },
                    scrollBeyondLastLine: false,
                    automaticLayout: true,
                    wordWrap: 'on'
                });

                // ç›‘å¬å†…å®¹å˜åŒ–
                monacoEditor.onDidChangeModelContent(() => {
                    const editingFile = document.getElementById('editingFile');
                    if (!editingFile.textContent.includes('â—')) {
                        editingFile.textContent = editingFile.textContent.replace('æ­£åœ¨ç¼–è¾‘:', 'â— æ­£åœ¨ç¼–è¾‘:');
                    }
                });
            });
        }

        function detectEnvironment() {
            // æ£€æµ‹æ“ä½œç³»ç»Ÿ
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('mac')) {
                currentPlatform = 'mac';
            } else if (userAgent.includes('win')) {
                currentPlatform = 'windows';
            } else {
                currentPlatform = 'linux';
            }
        }

        function detectPlatform() {
            const platformElement = document.getElementById('detectedPlatform');
            const platformStatus = document.getElementById('platformStatus');
            const mcpTarget = document.getElementById('mcpTarget');
            
            if (platformElement) {
                platformElement.textContent = currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1);
            }
            
            if (platformStatus) {
                platformStatus.textContent = `å·²æ£€æµ‹ ${currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1)}`;
            }
            
            // æ ¹æ®å¹³å°è®¾ç½®MCPç›®æ ‡
            let mcpTargetName = 'linux_terminal';
            if (currentPlatform === 'mac') {
                mcpTargetName = 'mac_terminal';
            } else if (currentPlatform === 'windows') {
                mcpTargetName = 'wsl_terminal';
            }
            
            if (mcpTarget) {
                mcpTarget.textContent = mcpTargetName;
            }
            
            // æ¨¡æ‹ŸMCPè¿æ¥
            setTimeout(() => {
                connectToMCP(mcpTargetName);
            }, 1500);
        }

        function connectToMCP(targetName) {
            const mcpSuccess = document.getElementById('mcpSuccess');
            const mcpStatus = document.getElementById('mcpStatus');
            
            mcpConnected = true;
            
            if (mcpSuccess) {
                let platformName = currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1);
                mcpSuccess.innerHTML = `âœ… æœ¬åœ°${platformName} MCPè¿æ¥æˆåŠŸ ğŸ”§ æœ¬åœ°ç»ˆç«¯æœåŠ¡å·²å¯åŠ¨`;
            }
            
            if (mcpStatus) {
                mcpStatus.textContent = 'MCP å·²è¿æ¥';
                mcpStatus.className = 'px-2 py-1 bg-green-600 text-white rounded text-sm';
            }
        }

        function updateModeDisplay() {
            const modeIndicator = document.getElementById('modeIndicator');
            const toggleBtn = document.getElementById('toggleModeBtn');
            const currentModeSpan = document.getElementById('currentMode');
            
            // ç¡®ä¿å˜é‡å·²åˆå§‹åŒ–
            if (typeof currentMode === 'undefined') {
                currentMode = 'cloud';
            }
            
            if (modeIndicator) {
                if (currentMode === 'cloud') {
                    modeIndicator.innerHTML = 'å¤„ç†æ¨¡å¼ï¼šğŸŒ äº‘ç«¯ç‰ˆæœ¬';
                } else {
                    modeIndicator.innerHTML = 'å¤„ç†æ¨¡å¼ï¼šğŸ–¥ï¸ æœ¬åœ°ç‰ˆæœ¬';
                }
            } else {
                console.error('modeIndicator element not found');
            }
            
            if (toggleBtn) {
                if (currentMode === 'cloud') {
                    toggleBtn.textContent = 'åˆ‡æ¢åˆ°æœ¬åœ°';
                } else {
                    toggleBtn.textContent = 'åˆ‡æ¢åˆ°äº‘ç«¯';
                }
            } else {
                console.error('toggleModeBtn element not found');
            }
            
            if (currentModeSpan) {
                currentModeSpan.textContent = currentMode === 'cloud' ? 'äº‘ç«¯ç‰ˆæœ¬' : 'æœ¬åœ°ç‰ˆæœ¬';
            }
        }

        function updateTerminalDisplay() {
            const platformConnection = document.getElementById('platformConnection');
            const mcpConnection = document.getElementById('mcpConnection');
            
            if (currentMode === 'local') {
                // æœ¬åœ°æ¨¡å¼ä¸‹æ˜¾ç¤ºçœŸå®çš„MCPè¿æ¥çŠ¶æ€
                if (platformConnection) {
                    let platformName = currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1);
                    let terminalName = currentPlatform === 'mac' ? 'mac_terminal' : 
                                     currentPlatform === 'windows' ? 'wsl_terminal' : 'linux_terminal';
                    platformConnection.innerHTML = `âœ… å¹³å°æ£€æµ‹æˆåŠŸ: ${platformName} â†’ è¿æ¥åˆ° ${terminalName}`;
                }
            }
        }

        function setupEventListeners() {
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });
            });

            // æ¨¡å¼åˆ‡æ¢
            const toggleModeBtn = document.getElementById('toggleModeBtn');
            if (toggleModeBtn) {
                toggleModeBtn.addEventListener('click', function() {
                    console.log('Mode toggle clicked, current mode:', currentMode);
                    currentMode = currentMode === 'cloud' ? 'local' : 'cloud';
                    console.log('New mode:', currentMode);
                    updateModeDisplay();
                    updateTerminalDisplay();
                    
                    // é‡æ–°æ£€æµ‹å¹³å°å’ŒMCPè¿æ¥
                    if (currentMode === 'local') {
                        detectPlatform();
                    }
                });
            } else {
                console.error('toggleModeBtn element not found');
            }

            // æŸ¥è¯¢åŠŸèƒ½
            document.getElementById('queryBtn').addEventListener('click', handleQuery);
            document.getElementById('queryInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleQuery();
                }
            });

            // ç»ˆç«¯è¾“å…¥
            document.getElementById('terminalInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleTerminalCommand();
                }
            });

            // æ–‡ä»¶åˆ—è¡¨ç‚¹å‡»
            document.querySelectorAll('.file-item').forEach(item => {
                item.addEventListener('click', function() {
                    const fileName = this.dataset.file;
                    openFileInComposer(fileName);
                });
            });

            // å¿«é€Ÿæ“ä½œæŒ‰é’®
            document.getElementById('openFolderBtn').addEventListener('click', handleOpenFolder);
            document.getElementById('cloneRepoBtn').addEventListener('click', handleCloneRepo);
            document.getElementById('connectRemoteBtn').addEventListener('click', handleConnectRemote);
            document.getElementById('newFileBtn').addEventListener('click', handleNewFile);

            // å…¶ä»–æŒ‰é’®
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('refreshPreviewBtn').addEventListener('click', handleRefreshPreview);
            document.getElementById('saveFileBtn').addEventListener('click', handleSaveFile);
            document.getElementById('formatCodeBtn').addEventListener('click', handleFormatCode);
        }

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // æ›´æ–°æ ‡ç­¾é¡µæ ·å¼
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('tab-inactive');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
        }

        function handleQuery() {
            const input = document.getElementById('queryInput');
            const query = input.value.trim();
            
            if (!query) return;
            
            const chatHistory = document.getElementById('chatHistory');
            
            // æ·»åŠ ç”¨æˆ·æŸ¥è¯¢
            const userMessage = document.createElement('div');
            userMessage.className = 'bg-blue-900 border border-blue-600 rounded-lg p-3 mb-3';
            userMessage.innerHTML = `<strong>æ‚¨:</strong> ${query}`;
            chatHistory.appendChild(userMessage);
            
            // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
            const processingMessage = document.createElement('div');
            processingMessage.className = 'bg-gray-700 border border-gray-600 rounded-lg p-3 mb-3';
            processingMessage.innerHTML = '<strong>AI:</strong> æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...';
            chatHistory.appendChild(processingMessage);
            
            // æ¨¡æ‹ŸAIå“åº”
            setTimeout(() => {
                processingMessage.innerHTML = `<strong>AI:</strong> 
                <div class="mt-2">
                    <p class="mb-2">æˆ‘æ¥å¸®æ‚¨å¼€å‘${query}ï¼</p>
                    <div class="bg-gray-800 p-3 rounded mt-2">
                        <p class="text-green-400 font-semibold">ğŸ“‹ æŠ€æœ¯æ–¹æ¡ˆ:</p>
                        <ul class="list-disc list-inside mt-2 text-sm">
                            <li><strong>æŠ€æœ¯æ ˆé€‰æ‹©:</strong> HTML5 Canvas + JavaScript, CSS3 + å“åº”å¼è®¾è®¡</li>
                            <li><strong>æ ¸å¿ƒåŠŸèƒ½:</strong> æ¸¸æˆé€»è¾‘ã€ç¢°æ’æ£€æµ‹ã€åˆ†æ•°ç³»ç»Ÿã€æ¸¸æˆé‡å¯</li>
                            <li><strong>å¼€å‘æ­¥éª¤:</strong> 1. åˆ›å»ºæ¸¸æˆç”»å¸ƒ 2. å®ç°è›‡çš„ç§»åŠ¨ 3. æ·»åŠ é£Ÿç‰©ç”Ÿæˆ 4. ç¢°æ’æ£€æµ‹</li>
                        </ul>
                    </div>
                </div>`;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }, 2000);
            
            input.value = '';
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function handleTerminalCommand() {
            const input = document.getElementById('terminalInput');
            const command = input.value.trim();
            
            if (!command) return;
            
            const output = document.getElementById('terminalOutput');
            
            // æ·»åŠ å‘½ä»¤åˆ°è¾“å‡º
            const commandLine = document.createElement('span');
            commandLine.innerHTML = `user@localhost:aicore0624$ ${command}\n`;
            output.appendChild(commandLine);
            
            // æ¨¡æ‹Ÿå‘½ä»¤æ‰§è¡Œ
            setTimeout(() => {
                const result = document.createElement('span');
                if (command === 'clear') {
                    output.innerHTML = '<span class="text-white">user@localhost:aicore0624$ </span>';
                } else if (command.startsWith('ls')) {
                    result.innerHTML = `README.md  package.json  PowerAutomation_local/  powerautomation_web/\nuser@localhost:aicore0624$ `;
                } else if (command === 'pwd') {
                    result.innerHTML = `/home/user/aicore0624\nuser@localhost:aicore0624$ `;
                } else {
                    result.innerHTML = `bash: ${command}: command not found\nuser@localhost:aicore0624$ `;
                }
                output.appendChild(result);
                output.scrollTop = output.scrollHeight;
            }, 500);
            
            input.value = '';
        }

        function openFileInComposer(fileName) {
            switchTab('composer');
            
            const editingFile = document.getElementById('editingFile');
            const codeEditor = document.getElementById('codeEditor');
            
            editingFile.textContent = `æ­£åœ¨ç¼–è¾‘: ${fileName}`;
            
            // æ¨¡æ‹Ÿæ–‡ä»¶å†…å®¹
            let fileContent = '';
            if (fileName === 'README.md') {
                fileContent = `# SmartUI + SmartInvention Flow MCP

## é¡¹ç›®ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªé›†æˆäº† SmartInvention Flow MCP çš„ SmartUI å·¥ä½œåŒºé¡¹ç›®ã€‚

## åŠŸèƒ½ç‰¹æ€§
- AIé©±åŠ¨çš„æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿ
- è·¨å¹³å°ç»ˆç«¯æœºæ”¯æŒ (Mac/Windows/Linux)
- å®æ—¶é¢„è§ˆåŠŸèƒ½
- å¿«é€Ÿæ“ä½œé¢æ¿
- æ–‡ä»¶ç¼–è¾‘å’Œç®¡ç†

## æŠ€æœ¯æ ˆ
- Frontend: HTML5, CSS3, JavaScript, Tailwind CSS
- Backend: PowerAutomation MCP
- Platform: Cross-platform support

## ä½¿ç”¨è¯´æ˜
1. é€‰æ‹©è¿è¡Œæ¨¡å¼ (äº‘ç«¯/æœ¬åœ°)
2. ä½¿ç”¨æ™ºèƒ½æŸ¥è¯¢è¯¢é—®å¼€å‘éœ€æ±‚
3. é€šè¿‡ç»ˆç«¯æœºæ‰§è¡Œå‘½ä»¤
4. é€šè¿‡å®æ—¶é¢„è§ˆå¼€å‘ç»“æœ

## éƒ¨ç½²çŠ¶æ€
- âœ… PowerAutomation_local è‡ªåŠ¨æˆåŠŸ
- âœ… PowerAutomation_web è‡ªåŠ¨æˆåŠŸ  
- âœ… SmartUI å·¥ä½œåŒºå·²å°±ç»ª`;
            } else if (fileName === 'package.json') {
                fileContent = `{
  "name": "smartui-workspace",
  "version": "2.0.0",
  "description": "SmartUI AI-First IDE with SmartInvention Flow MCP",
  "main": "index.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "build": "webpack --mode production"
  },
  "keywords": ["ai", "ide", "mcp", "smartui"],
  "author": "alexchuang650730",
  "license": "MIT",
  "dependencies": {
    "express": "^4.18.0",
    "socket.io": "^4.7.0",
    "tailwindcss": "^3.3.0"
  }
}`;
            } else {
                fileContent = `// ${fileName} æ–‡ä»¶å†…å®¹
// è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶

console.log('Hello from ${fileName}');

// åœ¨è¿™é‡Œæ·»åŠ æ‚¨çš„ä»£ç ...`;
            }
            
            codeEditor.value = fileContent;
        }

        function handleOpenFolder() {
            const statusDiv = document.querySelector('.space-y-2');
            
            // ç¡®ä¿å˜é‡å·²åˆå§‹åŒ–
            if (typeof currentMode === 'undefined') {
                currentMode = 'cloud';
            }
            if (typeof currentPlatform === 'undefined') {
                currentPlatform = 'linux';
            }
            
            // æ£€æŸ¥statusDivæ˜¯å¦å­˜åœ¨
            if (!statusDiv) {
                console.error('Status div not found');
                return;
            }
            
            // æ ¹æ®å½“å‰æ¨¡å¼æ‰“å¼€ä¸åŒçš„æ–‡ä»¶å¤¹
            let folderPath = '';
            let action = '';
            
            if (currentMode === 'cloud') {
                folderPath = '/cloud/workspace/aicore0624';
                action = 'æ­£åœ¨æ‰“å¼€äº‘ç«¯å·¥ä½œåŒºæ–‡ä»¶å¤¹...';
            } else {
                // æœ¬åœ°æ¨¡å¼æ ¹æ®å¹³å°é€‰æ‹©ä¸åŒè·¯å¾„
                if (currentPlatform === 'mac') {
                    folderPath = '~/Documents/aicore0624';
                    action = 'æ­£åœ¨æ‰“å¼€Macæœ¬åœ°æ–‡ä»¶å¤¹...';
                } else if (currentPlatform === 'windows') {
                    folderPath = 'C:\\Users\\%USERNAME%\\Documents\\aicore0624';
                    action = 'æ­£åœ¨æ‰“å¼€Windowsæœ¬åœ°æ–‡ä»¶å¤¹...';
                } else {
                    folderPath = '~/aicore0624';
                    action = 'æ­£åœ¨æ‰“å¼€Linuxæœ¬åœ°æ–‡ä»¶å¤¹...';
                }
            }
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            const newStatus = document.createElement('div');
            newStatus.className = 'text-blue-400';
            newStatus.innerHTML = `<span class="status-indicator mr-2">ğŸ”„</span><span>${action}</span>`;
            statusDiv.appendChild(newStatus);
            
            // æ¨¡æ‹Ÿæ–‡ä»¶å¤¹æ‰“å¼€è¿‡ç¨‹
            setTimeout(() => {
                newStatus.className = 'text-green-400';
                newStatus.innerHTML = `<span class="status-indicator mr-2">âœ“</span><span>å·²æ‰“å¼€æ–‡ä»¶å¤¹: ${folderPath}</span>`;
                
                // å¦‚æœæ˜¯æœ¬åœ°æ¨¡å¼ï¼Œè¿˜è¦æ˜¾ç¤ºMCPè¿æ¥çŠ¶æ€
                if (currentMode === 'local' && (typeof mcpConnected !== 'undefined' && mcpConnected)) {
                    const mcpStatus = document.createElement('div');
                    mcpStatus.className = 'text-green-400';
                    mcpStatus.innerHTML = `<span class="status-indicator mr-2">âœ“</span><span>æœ¬åœ°MCPæ–‡ä»¶ç³»ç»Ÿå·²è¿æ¥</span>`;
                    statusDiv.appendChild(mcpStatus);
                }
            }, 2000);
        }

        function handleCloneRepo() {
            const statusDiv = document.querySelector('.space-y-2');
            if (!statusDiv) {
                console.error('Status div not found');
                return;
            }
            const newStatus = document.createElement('div');
            newStatus.className = 'text-blue-400';
            newStatus.innerHTML = '<span class="status-indicator mr-2">ğŸ”„</span><span>æ­£åœ¨å…‹éš†Gitä»“åº“...</span>';
            statusDiv.appendChild(newStatus);
            
            setTimeout(() => {
                newStatus.className = 'text-green-400';
                newStatus.innerHTML = '<span class="status-indicator mr-2">âœ“</span><span>Gitä»“åº“å…‹éš†å®Œæˆ</span>';
            }, 3000);
        }

        function handleConnectRemote() {
            const statusDiv = document.querySelector('.space-y-2');
            if (!statusDiv) {
                console.error('Status div not found');
                return;
            }
            const newStatus = document.createElement('div');
            newStatus.className = 'text-blue-400';
            newStatus.innerHTML = '<span class="status-indicator mr-2">ğŸ”„</span><span>æ­£åœ¨è¿æ¥è¿œç¨‹ä¸»æœº...</span>';
            statusDiv.appendChild(newStatus);
            
            setTimeout(() => {
                newStatus.className = 'text-green-400';
                newStatus.innerHTML = '<span class="status-indicator mr-2">âœ“</span><span>è¿œç¨‹ä¸»æœºè¿æ¥æˆåŠŸ</span>';
            }, 2500);
        }

        function handleNewFile() {
            const statusDiv = document.querySelector('.space-y-2');
            if (!statusDiv) {
                console.error('Status div not found');
                return;
            }
            const newStatus = document.createElement('div');
            newStatus.className = 'text-green-400';
            newStatus.innerHTML = '<span class="status-indicator mr-2">âœ“</span><span>æ–°æ–‡ä»¶å·²åˆ›å»º</span>';
            statusDiv.appendChild(newStatus);
            
            // è‡ªåŠ¨åˆ‡æ¢åˆ°Composerå¹¶åˆ›å»ºæ–°æ–‡ä»¶
            setTimeout(() => {
                switchTab('composer');
                document.getElementById('editingFile').textContent = 'æ­£åœ¨ç¼–è¾‘: new_file.js';
                document.getElementById('codeEditor').value = '// æ–°å»ºæ–‡ä»¶\n// åœ¨è¿™é‡Œå¼€å§‹ç¼–å†™æ‚¨çš„ä»£ç ...\n\n';
            }, 500);
        }

        function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                window.location.href = 'smartui_login.html';
            }
        }

        function handleRefreshPreview() {
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '<div class="text-center py-20"><div class="animate-spin text-4xl mb-4">ğŸ”„</div><p>æ­£åœ¨åˆ·æ–°é¢„è§ˆ...</p></div>';
            
            setTimeout(() => {
                previewContent.innerHTML = `
                    <div class="text-center py-20">
                        <h3 class="text-2xl font-bold text-blue-600 mb-4">ğŸš€ SmartUI å®æ—¶é¢„è§ˆ</h3>
                        <p class="text-gray-600 mb-4">é¢„è§ˆå·²åˆ·æ–° - ${new Date().toLocaleTimeString()}</p>
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg max-w-md mx-auto">
                            <h4 class="text-lg font-semibold mb-2">å®æ—¶é¢„è§ˆå†…å®¹</h4>
                            <p>HTMLã€CSS å’Œ JavaScript çš„æœ€æ–°æ¸²æŸ“æ•ˆæœ</p>
                            <div class="mt-4 p-3 bg-white bg-opacity-20 rounded">
                                <p class="text-sm">å½“å‰æ¨¡å¼: ${currentMode === 'cloud' ? 'äº‘ç«¯ç‰ˆæœ¬' : 'æœ¬åœ°ç‰ˆæœ¬'}</p>
                                <p class="text-sm">å¹³å°: ${currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }, 1500);
        }

        function handleSaveFile() {
            if (monacoEditor) {
                const content = monacoEditor.getValue();
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ–‡ä»¶ä¿å­˜é€»è¾‘
                console.log('ä¿å­˜æ–‡ä»¶å†…å®¹:', content);
            }
            
            const statusDiv = document.querySelector('.bg-gray-900.rounded-lg.p-4 .space-y-2');
            const newStatus = document.createElement('div');
            newStatus.className = 'text-green-400';
            newStatus.innerHTML = '<span class="status-indicator mr-2">âœ“</span><span>æ–‡ä»¶ä¿å­˜æˆåŠŸ</span>';
            statusDiv.appendChild(newStatus);
        }

        function handleFormatCode() {
            if (monacoEditor) {
                // ä½¿ç”¨Monaco Editorçš„æ ¼å¼åŒ–åŠŸèƒ½
                monacoEditor.getAction('editor.action.formatDocument').run();
            }
            
            const statusDiv = document.querySelector('.bg-gray-900.rounded-lg.p-4 .space-y-2');
            const newStatus = document.createElement('div');
            newStatus.className = 'text-green-400';
            newStatus.innerHTML = '<span class="status-indicator mr-2">âœ“</span><span>ä»£ç æ ¼å¼åŒ–å®Œæˆ</span>';
            statusDiv.appendChild(newStatus);
        }
    </script>
</body>
</html>

