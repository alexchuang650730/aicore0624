<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartUI å·¥ä½œåŒº - AI-First IDE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/monaco-editor@0.34.0/min/vs/loader.js"></script>
    <style>
        .quick-actions-panel {
            width: 240px;
            min-height: 100vh;
        }
        .project-panel {
            width: 280px;
            min-height: 100vh;
        }
        .quick-action-btn {
            height: 48px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .quick-action-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .main-content {
            width: calc(100% - 520px);
        }
        .terminal-output {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }
        .terminal-line {
            display: block;
            margin-bottom: 2px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn.active {
            background-color: #3b82f6 !important;
            color: white !important;
        }
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn:hover {
            background-color: #1e40af;
            color: white;
        }
        
        /* é€€å‡ºç™»å½•æŒ‰é’®æ ·å¼ */
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        /* SmartUIæ ‡é¢˜æ ·å¼ */
        .smartui-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 16px;
            border-bottom: 1px solid #374151;
        }
        .smartui-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* æ»‘åŠ¨åˆ‡æ¢å™¨æ ·å¼ */
        .toggle-switch {
            position: relative;
            width: 120px;
            height: 32px;
            background: #374151;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #4b5563;
        }
        .toggle-switch.active {
            background: #3b82f6;
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 56px;
            height: 28px;
            background: white;
            border-radius: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(60px);
        }
        .toggle-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 1;
        }
        .toggle-text.left {
            left: 8px;
        }
        .toggle-text.right {
            right: 8px;
        }
        /* æœªæ¿€æ´»çŠ¶æ€ï¼šå·¦ä¾§é€‰ä¸­(aicore) */
        .toggle-switch:not(.active) .toggle-text.left {
            color: #374151; /* æ·±è‰²æ–‡å­—åœ¨ç™½è‰²æ»‘å—ä¸Š */
        }
        .toggle-switch:not(.active) .toggle-text.right {
            color: #d1d5db; /* æ›´äº®çš„ç°è‰²æ–‡å­—ï¼Œæé«˜å¯è§åº¦ */
        }
        /* æ¿€æ´»çŠ¶æ€ï¼šå³ä¾§é€‰ä¸­(manus) */
        .toggle-switch.active .toggle-text.left {
            color: #e5e7eb; /* æ›´äº®çš„ç™½è‰²æ–‡å­—åœ¨è“è‰²èƒŒæ™¯ä¸Š */
        }
        .toggle-switch.active .toggle-text.right {
            color: #374151; /* æ·±è‰²æ–‡å­—åœ¨ç™½è‰²æ»‘å—ä¸Š */
        }
        
        /* ç³»ç»ŸçŠ¶æ€é¢æ¿æ ·å¼ */
        .system-status-panel {
            background: rgba(55, 65, 81, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        }
        .status-dot.disconnected {
            background-color: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
        }
        
        /* æ–‡ä»¶é¡¹æ ·å¼ */
        .file-item {
            transition: all 0.2s ease;
        }
        .file-item:hover {
            background-color: #374151;
            transform: translateX(4px);
        }
        .file-item.selected {
            background-color: #3b82f6;
            color: white;
        }
        
        /* æˆåŠŸæç¤ºåŠ¨ç”» */
        @keyframes success-flash {
            0% { background-color: #10b981; }
            50% { background-color: #059669; }
            100% { background-color: #10b981; }
        }
        
        .success-flash {
            animation: success-flash 0.5s ease;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #1f2937;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
            border: 1px solid #374151;
        }
        .close {
            color: #9ca3af;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- å³ä¸Šè§’é€€å‡ºç™»å½•æŒ‰é’® -->
    <button class="logout-btn px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium shadow-lg" id="logoutBtn">
        é€€å‡ºç™»å½•
    </button>

    <!-- å…‹éš†ä»“åº“æ¨¡æ€æ¡† -->
    <div id="cloneModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeCloneModal">&times;</span>
            <h2 class="text-xl font-bold mb-4">å…‹éš†Gitä»“åº“</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">ä»“åº“URL:</label>
                <input type="text" id="repoUrl" class="w-full p-2 bg-gray-700 border border-gray-600 rounded" placeholder="https://github.com/alexchuang650730/aicore0624.git" value="https://github.com/alexchuang650730/aicore0624.git">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">æœ¬åœ°ç›®å½•å:</label>
                <input type="text" id="localDir" class="w-full p-2 bg-gray-700 border border-gray-600 rounded" placeholder="aicore0624" value="aicore0624">
            </div>
            <div class="flex gap-2">
                <button id="confirmClone" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">å…‹éš†</button>
                <button id="cancelClone" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æ‰“å¼€æ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div id="folderModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh;">
            <span class="close" id="closeFolderModal">&times;</span>
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <span>ğŸ“</span>
                <span>æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹</span>
            </h2>
            
            <!-- å½“å‰è·¯å¾„æ˜¾ç¤º -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">å½“å‰è·¯å¾„:</label>
                <div class="flex items-center gap-2">
                    <input type="text" id="currentPath" class="flex-1 p-2 bg-gray-700 border border-gray-600 rounded text-sm font-mono" value="/home/ec2-user" readonly>
                    <button id="goUpFolder" class="px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded transition-colors" title="ä¸Šçº§ç›®å½•">
                        <span class="text-sm">â†‘</span>
                    </button>
                    <button id="refreshFolder" class="px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded transition-colors" title="åˆ·æ–°">
                        <span class="text-sm">âŸ³</span>
                    </button>
                </div>
            </div>
            
            <!-- æ–‡ä»¶å¤¹æµè§ˆå™¨ -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">æµè§ˆæ–‡ä»¶å¤¹:</label>
                <div id="folderBrowser" class="bg-gray-800 border border-gray-600 rounded p-3 h-72 overflow-y-auto">
                    <div class="text-gray-400 text-center py-8 flex items-center justify-center gap-2">
                        <span class="animate-spin">âŸ³</span>
                        <span>åŠ è½½ä¸­...</span>
                    </div>
                </div>
            </div>
            
            <!-- é€‰ä¸­çš„æ–‡ä»¶å¤¹ -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">é€‰ä¸­çš„é¡¹ç›®æ–‡ä»¶å¤¹:</label>
                <input type="text" id="selectedFolder" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-sm font-mono" placeholder="è¯·é€‰æ‹©ä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹" readonly>
            </div>
            
            <!-- æ“ä½œæç¤º -->
            <div class="mb-4 p-3 bg-blue-900/30 border border-blue-600/50 rounded">
                <div class="text-sm text-blue-300">
                    <div class="font-medium mb-1">ğŸ’¡ æ“ä½œæç¤º:</div>
                    <div>â€¢ å•å‡»é€‰æ‹©æ–‡ä»¶å¤¹ï¼ŒåŒå‡»è¿›å…¥å­æ–‡ä»¶å¤¹</div>
                    <div>â€¢ é€‰æ‹©åŒ…å«é¡¹ç›®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä½œä¸ºå·¥ä½œåŒº</div>
                    <div>â€¢ æ”¯æŒæµè§ˆ aicore0624ã€aicore0701ã€powerautomation_web ç­‰é¡¹ç›®</div>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="confirmFolder" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors font-medium" disabled>é€‰æ‹©æ­¤æ–‡ä»¶å¤¹</button>
                <button id="cancelFolder" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded transition-colors">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="flex h-screen">
        <!-- å·¦ä¾§é¡¹ç›®èµ„æºé¢æ¿ -->
        <div class="project-panel bg-gray-800 border-r border-gray-700 flex flex-col">
            <!-- SmartUI æ ‡é¢˜åŒºåŸŸ -->
            <div class="smartui-header">
                <div class="flex items-center space-x-4">
                    <div class="smartui-logo">ğŸ¯</div>
                    <div>
                        <h1 class="text-xl font-bold text-white">SmartUI</h1>
                        <p class="text-sm text-gray-200 opacity-90">AI-First IDE Platform</p>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®èµ„æºæ ‡é¢˜ -->
            <div class="p-4 border-b border-gray-700">
                <h2 class="text-md font-semibold text-blue-400 flex items-center gap-2">
                    <span>ğŸ“</span>
                    <span>é¡¹ç›®èµ„æº</span>
                </h2>
                <p class="text-xs text-gray-400 mt-1" id="currentWorkspace">powerautomation_web</p>
            </div>

            <!-- é¡¹ç›®æ–‡ä»¶æµè§ˆå™¨ -->
            <div class="flex-1 p-4 overflow-y-auto" id="fileExplorer">
                <div class="space-y-1" id="fileList">
                    <!-- æ–‡ä»¶åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å·¦ä¸‹è§’ç³»ç»ŸçŠ¶æ€é¢æ¿ -->
            <div class="p-4">
                <div class="system-status-panel">
                    <div class="p-3">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-blue-400">ğŸ“Š</span>
                            <span class="font-semibold text-sm">ç³»ç»ŸçŠ¶æ€</span>
                        </div>
                        
                        <div class="space-y-2">
                            <div class="status-item">
                                <div class="flex items-center gap-2">
                                    <span>ğŸš€</span>
                                    <span class="text-sm">ä¸€é”®éƒ¨ç½²</span>
                                </div>
                                <div class="status-dot" id="deployStatusDot"></div>
                            </div>
                            
                            <div class="status-item">
                                <div class="flex items-center gap-2">
                                    <span>ğŸ”§</span>
                                    <span class="text-sm">LSP</span>
                                </div>
                                <div class="status-dot" id="lspStatusDot"></div>
                            </div>
                            
                            <div class="status-item">
                                <div class="flex items-center gap-2">
                                    <span>ğŸ”—</span>
                                    <span class="text-sm">SSHéš§é“</span>
                                </div>
                                <div class="status-dot" id="sshTunnelDot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content bg-gray-900 flex flex-col">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-300">å·¥ä½œåŒº: <span id="workspacePath">/home/ec2-user/powerautomation_web</span></span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- aicore/manusæ¨¡å¼åˆ‡æ¢ -->
                    <div class="toggle-switch" id="aiModeToggle">
                        <div class="toggle-slider"></div>
                        <span class="toggle-text left">aicore</span>
                        <span class="toggle-text right">manus</span>
                    </div>
                    
                    <!-- ç«¯ä¾§/äº‘ä¾§æ¨¡å¼åˆ‡æ¢ -->
                    <div class="toggle-switch active" id="deployModeToggle">
                        <div class="toggle-slider"></div>
                        <span class="toggle-text left">ç«¯ä¾§</span>
                        <span class="toggle-text right">äº‘ä¾§</span>
                    </div>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
            <div class="bg-gray-800 border-b border-gray-700 px-4 py-2">
                <div class="flex space-x-2">
                    <button class="tab-btn px-4 py-2 rounded-t-lg bg-blue-600 text-white active" data-tab="cascade">
                        âœ¨ Cascade åä½œ
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-700 text-gray-300" data-tab="composer">
                        ğŸ’» Composer
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-700 text-gray-300" data-tab="preview">
                        ğŸ‘ï¸ å®æ—¶é¢„è§ˆ
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-700 text-gray-300" data-tab="terminal">
                        ğŸ–¥ï¸ ç»ˆç«¯æœº
                    </button>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µå†…å®¹ -->
            <div class="flex-1 overflow-hidden">
                <!-- Cascade åä½œæ ‡ç­¾é¡µ -->
                <div id="cascade" class="tab-content active h-full flex flex-col bg-gray-900">
                    <div class="flex-1 p-6">
                        <!-- æ ‡é¢˜åŒºåŸŸ -->
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-white mb-2">âœ¨ Cascade åä½œæ¨¡å¼</h2>
                            <p class="text-gray-400">å¤šäººå®æ—¶åä½œå¼€å‘ï¼ŒAIè¾…åŠ©ç¼–ç¨‹</p>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- åä½œæˆå‘˜ -->
                            <div class="bg-gray-800 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <span>ğŸ‘¥</span>
                                    <span>åä½œæˆå‘˜</span>
                                </h3>
                                
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 p-3 bg-gray-700 rounded-lg">
                                        <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">
                                            A
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-medium text-white">Alex (ä½ )</div>
                                            <div class="text-sm text-gray-400">é¡¹ç›®è´Ÿè´£äºº</div>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                            <span class="text-sm text-green-400">åœ¨çº¿</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-3 p-3 bg-gray-700 rounded-lg">
                                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white">
                                            ğŸ¤–
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-medium text-white">Claude AI</div>
                                            <div class="text-sm text-gray-400">AIç¼–ç¨‹åŠ©æ‰‹</div>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                            <span class="text-sm text-green-400">å°±ç»ª</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å½“å‰ä»»åŠ¡ -->
                            <div class="bg-gray-800 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <span>ğŸ¯</span>
                                    <span>å½“å‰ä»»åŠ¡</span>
                                </h3>
                                
                                <div class="space-y-4">
                                    <div>
                                        <div class="text-sm text-gray-400 mb-1">æ­£åœ¨å¼€å‘:</div>
                                        <div class="text-blue-400 font-medium">PowerAutomation Web IDE</div>
                                    </div>
                                    
                                    <div>
                                        <div class="text-sm text-gray-400 mb-2">è¿›åº¦: 75%</div>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full" style="width: 75%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-2">
                                        <div class="text-sm text-gray-400">æœ€è¿‘æ´»åŠ¨:</div>
                                        <div class="text-sm text-gray-300">
                                            â€¢ å®ŒæˆSmartUIå·¥ä½œåŒºç•Œé¢è®¾è®¡<br>
                                            â€¢ é›†æˆWebSocketç»ˆç«¯åŠŸèƒ½<br>
                                            â€¢ æ·»åŠ HITLå·¥ä½œæµæŒ‰é’®
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åä½œå·¥å…·æ  -->
                        <div class="mt-8 flex justify-center space-x-4">
                            <button class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2">
                                <span>ğŸ’¬</span>
                                <span>å¼€å§‹åä½œ</span>
                            </button>
                            <button class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-2">
                                <span>ğŸ”„</span>
                                <span>åŒæ­¥ä»£ç </span>
                            </button>
                            <button class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center gap-2">
                                <span>ğŸ¤–</span>
                                <span>AIåŠ©æ‰‹</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Composer æ ‡ç­¾é¡µ -->
                <div id="composer" class="tab-content h-full flex flex-col" style="display: none;">
                    <!-- Monaco Editor å·¥å…·æ  -->
                    <div class="bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-blue-400">ğŸ’» Monaco Editor + LSP</span>
                            <span class="text-xs text-gray-400" id="currentFile">æœªé€‰æ‹©æ–‡ä»¶</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="saveBtn" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">
                                ä¿å­˜æ–‡ä»¶
                            </button>
                            <button id="formatBtn" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">
                                æ ¼å¼åŒ–ä»£ç 
                            </button>
                            <button id="minimapBtn" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded text-sm">
                                ğŸ—ºï¸ å°åœ°å›¾
                            </button>
                            <button id="findReplaceBtn" class="px-3 py-1 bg-orange-600 hover:bg-orange-700 text-white rounded text-sm">
                                ğŸ” æŸ¥æ‰¾æ›¿æ¢
                            </button>
                        </div>
                    </div>
                    
                    <!-- Monaco Editor å®¹å™¨ -->
                    <div id="monacoContainer" class="flex-1 bg-gray-900"></div>
                </div>

                <!-- ç»ˆç«¯æ ‡ç­¾é¡µ -->
                <div id="terminal" class="tab-content h-full bg-black p-4" style="display: none;">
                    <div class="h-full flex flex-col">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-green-400 text-sm font-mono" id="terminalPrompt">ec2-user@smartui:~$</span>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs text-gray-400" id="terminalStatus">å·²è¿æ¥</span>
                                <div class="w-2 h-2 bg-green-400 rounded-full" id="terminalIndicator"></div>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto">
                            <div id="terminalOutput" class="terminal-output text-green-400 font-mono text-sm"></div>
                        </div>
                        <div class="flex items-center mt-2">
                            <span class="text-green-400 font-mono text-sm mr-2" id="inputPrompt">$</span>
                            <input type="text" id="terminalInput" class="flex-1 bg-transparent text-green-400 font-mono text-sm outline-none" placeholder="è¾“å…¥å‘½ä»¤...">
                        </div>
                    </div>
                </div>

                <!-- é¢„è§ˆæ ‡ç­¾é¡µ -->
                <div id="preview" class="tab-content h-full bg-white" style="display: none;">
                    <iframe id="previewFrame" class="w-full h-full border-0" src="about:blank"></iframe>
                </div>
            </div>
        </div>

        <!-- å³ä¾§å¿«é€Ÿæ“ä½œé¢æ¿         <!-- å³ä¾§å¿«é€Ÿæ“ä½œé¢æ¿ -->
        <div class="quick-actions-panel bg-gray-800 border-l border-gray-700 p-4">
            <h3 class="text-lg font-semibold mb-4 text-blue-400">å¿«é€Ÿæ“ä½œ</h3>
            
            <div class="space-y-3">
                <!-- é¡¹ç›®ç®¡ç† -->
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-300 mb-2">é¡¹ç›®ç®¡ç†</h4>
                    <button id="cloneRepoBtn" class="quick-action-btn w-full bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2">
                        <span>ğŸ“¥</span>
                        <span>å…‹éš†ä»“åº“</span>
                    </button>
                    <button id="openFolderBtn" class="quick-action-btn w-full bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center gap-2 mt-2">
                        <span>ğŸ“</span>
                        <span>æ‰“å¼€æ–‡ä»¶å¤¹</span>
                    </button>
                </div>

                <!-- HITLå·¥ä½œæµ -->
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-300 mb-2">HITLå·¥ä½œæµ</h4>
                                    <!-- éœ€æ±‚åˆ†æ -->
                    <button id="requirementAnalysisBtn" class="quick-action-btn w-full bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg flex items-center justify-center gap-2 mb-2">
                        <span>ğŸ“‹</span>
                        <span>éœ€æ±‚åˆ†æ</span>
                    </button>
                    
                    <!-- æ¶æ„è®¾è®¡ -->
                    <button id="architectureDesignBtn" class="quick-action-btn w-full bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2 mb-2">
                        <span>ğŸ—ï¸</span>
                        <span>æ¶æ„è®¾è®¡</span>
                    </button>
                    
                    <!-- ç¼–ç å®ç° -->
                    <button id="codingImplementationBtn" class="quick-action-btn w-full bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center justify-center gap-2 mb-2">
                        <span>ğŸ’»</span>
                        <span>ç¼–ç å®ç°</span>
                    </button>
                    
                    <!-- æµ‹è¯•éªŒè¯ -->
                    <button id="testingValidationBtn" class="quick-action-btn w-full bg-orange-600 hover:bg-orange-700 text-white rounded-lg flex items-center justify-center gap-2 mb-2">
                        <span>ğŸ§ª</span>
                        <span>æµ‹è¯•éªŒè¯</span>
                    </button>
                    
                    <!-- éƒ¨ç½²å‘å¸ƒ -->
                    <button id="deploymentReleaseBtn" class="quick-action-btn w-full bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center justify-center gap-2 mb-2">
                        <span>ğŸš€</span>
                        <span>éƒ¨ç½²å‘å¸ƒ</span>
                    </button>
                    
                    <!-- ç›‘æ§è¿ç»´ -->
                    <button id="monitoringOpsBtn" class="quick-action-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center justify-center gap-2">
                        <span>ğŸ“Š</span>
                        <span>ç›‘æ§è¿ç»´</span>
                    </button>          </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let monacoEditor = null;
        let lspSocket = null;
        let currentMode = 'cloud'; // 'cloud' æˆ– 'local'
        let currentAIMode = 'aicore'; // 'aicore' æˆ– 'manus'
        let currentWorkspace = '/home/ec2-user/powerautomation_web';
        let currentFiles = [];
        let sshTunnelConnected = true; // å‡è®¾SSHéš§é“å·²é€šè¿‡ç™»å½•å»ºç«‹

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeMonacoEditor();
            initializeLSPConnection();
            initializeEventListeners();
            initializeFileExplorer();
            updateTerminalMode();
            updateSystemStatus();
            initializeToggleSwitches();
            initializeTerminal();
        });

        // åˆå§‹åŒ–ç»ˆç«¯
        function initializeTerminal() {
            addTerminalOutput('SmartUI IDE ç»ˆç«¯å·²å¯åŠ¨');
            addTerminalOutput('SSHéš§é“å·²å»ºç«‹ï¼Œæ”¯æŒç«¯ä¾§/äº‘ä¾§æ— ç¼åˆ‡æ¢');
            addTerminalOutput('å½“å‰æ¨¡å¼: äº‘ä¾§ç»ˆç«¯ (EC2)');
            addTerminalOutput('');
        }

        // åˆå§‹åŒ–åˆ‡æ¢å™¨çŠ¶æ€
        function initializeToggleSwitches() {
            const aiModeToggle = document.getElementById('aiModeToggle');
            const deployModeToggle = document.getElementById('deployModeToggle');
            
            // è®¾ç½®åˆå§‹çŠ¶æ€ï¼šaicoreæ¨¡å¼ï¼ˆä¸æ¿€æ´»ï¼‰ï¼Œäº‘ä¾§æ¨¡å¼ï¼ˆæ¿€æ´»ï¼‰
            aiModeToggle.classList.remove('active');
            deployModeToggle.classList.add('active');
            
            console.log('åˆ‡æ¢å™¨åˆå§‹åŒ–å®Œæˆ - AIæ¨¡å¼:', currentAIMode, 'éƒ¨ç½²æ¨¡å¼:', currentMode);
        }

        // åˆå§‹åŒ–Monaco Editor
        function initializeMonacoEditor() {
            require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.34.0/min/vs' } });
            require(['vs/editor/editor.main'], function () {
                monacoEditor = monaco.editor.create(document.getElementById('monacoContainer'), {
                    value: '# æ¬¢è¿ä½¿ç”¨ SmartUI IDE\n\n# è¯·ä»å·¦ä¾§é¡¹ç›®èµ„æºä¸­é€‰æ‹©æ–‡ä»¶å¼€å§‹ç¼–è¾‘\n# LSPæœåŠ¡å™¨å°†æä¾›æ™ºèƒ½è¡¥å…¨ã€é”™è¯¯è¯Šæ–­ç­‰åŠŸèƒ½\n# SSHéš§é“å·²å»ºç«‹ï¼Œæ”¯æŒç«¯ä¾§/äº‘ä¾§æ— ç¼åˆ‡æ¢\n\ndef hello_smartui():\n    print("Hello from SmartUI!")\n    return "AI-First IDE Platform"',
                    language: 'python',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    fontSize: 14,
                    lineNumbers: 'on',
                    minimap: { enabled: true },
                    scrollBeyondLastLine: false,
                    wordWrap: 'on',
                    suggestOnTriggerCharacters: true,
                    quickSuggestions: true,
                    parameterHints: { enabled: true },
                    formatOnPaste: true,
                    formatOnType: true
                });

                // ç›‘å¬ç¼–è¾‘å™¨å†…å®¹å˜åŒ–
                monacoEditor.onDidChangeModelContent(function() {
                    if (lspSocket && lspSocket.readyState === WebSocket.OPEN) {
                        const content = monacoEditor.getValue();
                        sendLSPMessage({
                            method: 'textDocument/didChange',
                            params: {
                                textDocument: { uri: 'file:///current.py' },
                                contentChanges: [{ text: content }]
                            }
                        });
                    }
                });
            });
        }

        // åˆå§‹åŒ–LSPè¿æ¥
        function initializeLSPConnection() {
            try {
                lspSocket = new WebSocket('ws://localhost:8081');
                
                lspSocket.onopen = function() {
                    console.log('LSP WebSocketè¿æ¥å·²å»ºç«‹');
                    updateLSPStatus(true);
                    
                    // å‘é€åˆå§‹åŒ–æ¶ˆæ¯
                    sendLSPMessage({
                        method: 'initialize',
                        params: {
                            processId: null,
                            rootUri: 'file:///workspace',
                            capabilities: {
                                textDocument: {
                                    completion: { dynamicRegistration: true },
                                    hover: { dynamicRegistration: true },
                                    signatureHelp: { dynamicRegistration: true },
                                    definition: { dynamicRegistration: true },
                                    references: { dynamicRegistration: true },
                                    documentHighlight: { dynamicRegistration: true },
                                    documentSymbol: { dynamicRegistration: true },
                                    formatting: { dynamicRegistration: true },
                                    rangeFormatting: { dynamicRegistration: true },
                                    rename: { dynamicRegistration: true },
                                    publishDiagnostics: { relatedInformation: true }
                                }
                            }
                        }
                    });
                };
                
                lspSocket.onmessage = function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        handleLSPMessage(message);
                    } catch (e) {
                        console.error('LSPæ¶ˆæ¯è§£æé”™è¯¯:', e);
                    }
                };
                
                lspSocket.onclose = function() {
                    console.log('LSP WebSocketè¿æ¥å·²å…³é—­');
                    updateLSPStatus(false);
                    // å°è¯•é‡è¿
                    setTimeout(initializeLSPConnection, 3000);
                };
                
                lspSocket.onerror = function(error) {
                    console.error('LSP WebSocketé”™è¯¯:', error);
                    updateLSPStatus(false);
                };
                
            } catch (error) {
                console.error('LSPè¿æ¥åˆå§‹åŒ–å¤±è´¥:', error);
                updateLSPStatus(false);
            }
        }

        // å‘é€LSPæ¶ˆæ¯
        function sendLSPMessage(message) {
            if (lspSocket && lspSocket.readyState === WebSocket.OPEN) {
                lspSocket.send(JSON.stringify(message));
            }
        }

        // å¤„ç†LSPæ¶ˆæ¯
        function handleLSPMessage(message) {
            if (message.method === 'textDocument/publishDiagnostics') {
                // å¤„ç†è¯Šæ–­ä¿¡æ¯
                const diagnostics = message.params.diagnostics;
                if (monacoEditor && diagnostics.length > 0) {
                    const markers = diagnostics.map(diag => ({
                        startLineNumber: diag.range.start.line + 1,
                        startColumn: diag.range.start.character + 1,
                        endLineNumber: diag.range.end.line + 1,
                        endColumn: diag.range.end.character + 1,
                        message: diag.message,
                        severity: diag.severity === 1 ? monaco.MarkerSeverity.Error : monaco.MarkerSeverity.Warning
                    }));
                    monaco.editor.setModelMarkers(monacoEditor.getModel(), 'lsp', markers);
                }
            }
        }

        // æ›´æ–°ç³»ç»ŸçŠ¶æ€
        function updateSystemStatus() {
            // ä¸€é”®éƒ¨ç½²çŠ¶æ€ï¼ˆå‡è®¾å·²é€šè¿‡ç™»å½•å»ºç«‹ï¼‰
            const deployStatusDot = document.getElementById('deployStatusDot');
            deployStatusDot.classList.remove('disconnected');
            
            // SSHéš§é“çŠ¶æ€ï¼ˆå‡è®¾å·²é€šè¿‡ç™»å½•å»ºç«‹ï¼‰
            const sshTunnelDot = document.getElementById('sshTunnelDot');
            if (sshTunnelConnected) {
                sshTunnelDot.classList.remove('disconnected');
            } else {
                sshTunnelDot.classList.add('disconnected');
            }
        }

        // æ›´æ–°LSPçŠ¶æ€
        function updateLSPStatus(connected) {
            const statusDot = document.getElementById('lspStatusDot');
            if (connected) {
                statusDot.classList.remove('disconnected');
            } else {
                statusDot.classList.add('disconnected');
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    switchTab(tabId);
                });
            });

            // æ¨¡å¼åˆ‡æ¢
            document.getElementById('aiModeToggle').addEventListener('click', function() {
                this.classList.toggle('active');
                currentAIMode = this.classList.contains('active') ? 'manus' : 'aicore';
                console.log('AIæ¨¡å¼åˆ‡æ¢ä¸º:', currentAIMode);
            });

            document.getElementById('deployModeToggle').addEventListener('click', function() {
                if (!sshTunnelConnected) {
                    alert('SSHéš§é“æœªå»ºç«‹ï¼Œæ— æ³•åˆ‡æ¢æ¨¡å¼ã€‚è¯·å…ˆè¿è¡Œä¸€é”®éƒ¨ç½²å»ºç«‹è¿æ¥ã€‚');
                    return;
                }
                
                this.classList.toggle('active');
                currentMode = this.classList.contains('active') ? 'cloud' : 'local';
                updateTerminalMode();
                updateWorkspacePath();
                switchEnvironment();
                console.log('éƒ¨ç½²æ¨¡å¼åˆ‡æ¢ä¸º:', currentMode);
            });

            // å·¥å…·æ æŒ‰é’®
            document.getElementById('saveBtn').addEventListener('click', saveFile);
            document.getElementById('formatBtn').addEventListener('click', formatCode);
            document.getElementById('minimapBtn').addEventListener('click', toggleMinimap);
            document.getElementById('findReplaceBtn').addEventListener('click', openFindReplace);

            // å…‹éš†ä»“åº“æ¨¡æ€æ¡†
            document.getElementById('cloneRepoBtn').addEventListener('click', function() {
                document.getElementById('cloneModal').style.display = 'block';
            });
            document.getElementById('closeCloneModal').addEventListener('click', function() {
                document.getElementById('cloneModal').style.display = 'none';
            });
            document.getElementById('cancelClone').addEventListener('click', function() {
                document.getElementById('cloneModal').style.display = 'none';
            });
            document.getElementById('confirmClone').addEventListener('click', cloneRepository);

            // æ‰“å¼€æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
            document.getElementById('openFolderBtn').addEventListener('click', function() {
                document.getElementById('folderModal').style.display = 'block';
                loadFolderContents('/home/ec2-user'); // åŠ è½½é»˜è®¤ç›®å½•
            });
            document.getElementById('closeFolderModal').addEventListener('click', function() {
                document.getElementById('folderModal').style.display = 'none';
            });
            document.getElementById('cancelFolder').addEventListener('click', function() {
                document.getElementById('folderModal').style.display = 'none';
            });
            document.getElementById('confirmFolder').addEventListener('click', openSelectedFolder);
            document.getElementById('goUpFolder').addEventListener('click', goUpDirectory);
            document.getElementById('refreshFolder').addEventListener('click', refreshCurrentDirectory);

            // HITLå·¥ä½œæµæŒ‰é’®äº‹ä»¶
            document.getElementById('requirementAnalysisBtn').addEventListener('click', () => {
                openHITLWorkflow('requirement', 'éœ€æ±‚åˆ†æ', '', 'æ™ºèƒ½å¼•æ“è¾…åŠ©éœ€æ±‚æ”¶é›†å’Œåˆ†æ');
            });
            document.getElementById('architectureDesignBtn').addEventListener('click', () => {
                openHITLWorkflow('architecture', 'æ¶æ„è®¾è®¡', '', 'æ™ºèƒ½å¼•æ“è¾…åŠ©ç³»ç»Ÿæ¶æ„è®¾è®¡');
            });
            document.getElementById('codingImplementationBtn').addEventListener('click', () => {
                openHITLWorkflow('coding', 'ç¼–ç å®ç°', '', 'Claude Code SDKè¾…åŠ©ä»£ç ç”Ÿæˆ');
            });
            document.getElementById('testingValidationBtn').addEventListener('click', () => {
                openHITLWorkflow('testing', 'æµ‹è¯•éªŒè¯', '', 'æ¨¡æ¿æµ‹è¯•ç”Ÿæˆå¼•æ“è¾…åŠ©æµ‹è¯•');
            });
            document.getElementById('deploymentReleaseBtn').addEventListener('click', () => {
                openHITLWorkflow('deploy', 'éƒ¨ç½²å‘å¸ƒ', '', 'Release Manager + æ’ä»¶ç³»ç»Ÿ');
            });
            document.getElementById('monitoringOpsBtn').addEventListener('click', () => {
                openHITLWorkflow('monitor', 'ç›‘æ§è¿ç»´', '', 'AdminBoardè¿ç»´ç›‘æ§');
            });

            // é€€å‡ºç™»å½• - ä¿®å¤è·¯å¾„ï¼Œè·³è½¬åˆ°deploymentç›®å½•çš„ç™»å½•é¡µé¢
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                    // è·³è½¬åˆ°deploymentç›®å½•çš„ç™»å½•é¡µé¢
                    window.location.href = '../deployment/static/index.html';
                }
            });

            // å…‹éš†ä»“åº“å’Œæ‰“å¼€æ–‡ä»¶å¤¹
            document.getElementById('cloneRepoBtn').addEventListener('click', showCloneModal);
            document.getElementById('openFolderBtn').addEventListener('click', showFolderModal);

            // æ¨¡æ€æ¡†äº‹ä»¶
            setupModalEvents();

            // ç»ˆç«¯è¾“å…¥
            document.getElementById('terminalInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    executeTerminalCommand(this.value);
                    this.value = '';
                }
            });
        }

        // åˆ‡æ¢ç¯å¢ƒ
        function switchEnvironment() {
            addTerminalOutput(`æ­£åœ¨åˆ‡æ¢åˆ°${currentMode === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'}ç¯å¢ƒ...`);
            
            // æ¨¡æ‹Ÿç¯å¢ƒåˆ‡æ¢è¿‡ç¨‹
            setTimeout(() => {
                addTerminalOutput(`âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°${currentMode === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'}ç¯å¢ƒ`);
                addTerminalOutput(`å½“å‰å·¥ä½œç›®å½•: ${currentWorkspace}`);
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
                loadEnvironmentFiles();
            }, 1000);
        }

        // åŠ è½½ç¯å¢ƒæ–‡ä»¶
        function loadEnvironmentFiles() {
            if (currentMode === 'cloud') {
                // äº‘ä¾§æ–‡ä»¶
                currentFiles = [
                    { name: 'powerautomation_web', type: 'folder', children: [] },
                    { name: 'README.md', type: 'file', content: '# PowerAutomation Web (äº‘ä¾§)\n\nè¿™æ˜¯äº‘ä¾§EC2ç¯å¢ƒçš„é¡¹ç›®æ–‡ä»¶ã€‚\n\n## äº‘ä¾§ç‰¹æ€§\n\n- é«˜æ€§èƒ½è®¡ç®—èµ„æº\n- å¼¹æ€§æ‰©å±•èƒ½åŠ›\n- 24/7å¯ç”¨æ€§\n\n```python\n# äº‘ä¾§Pythonç¤ºä¾‹\ndef cloud_function():\n    print("Running on EC2 cloud!")\n    return "cloud-mode"\n```' },
                    { name: 'deploy.sh', type: 'file', content: '#!/bin/bash\n# äº‘ä¾§éƒ¨ç½²è„šæœ¬\necho "Deploying to EC2..."\ndocker build -t app .\ndocker run -p 80:3000 app' },
                    { name: 'config.yaml', type: 'file', content: '# äº‘ä¾§é…ç½®\nmode: cloud\nhost: 0.0.0.0\nport: 3000\nenv: production' }
                ];
            } else {
                // ç«¯ä¾§æ–‡ä»¶
                currentFiles = [
                    { name: 'local_project', type: 'folder', children: [] },
                    { name: 'README.md', type: 'file', content: '# PowerAutomation Web (ç«¯ä¾§)\n\nè¿™æ˜¯ç«¯ä¾§æœ¬åœ°ç¯å¢ƒçš„é¡¹ç›®æ–‡ä»¶ã€‚\n\n## ç«¯ä¾§ç‰¹æ€§\n\n- æœ¬åœ°å¼€å‘ç¯å¢ƒ\n- å¿«é€Ÿè¿­ä»£\n- ç¦»çº¿å·¥ä½œèƒ½åŠ›\n\n```python\n# ç«¯ä¾§Pythonç¤ºä¾‹\ndef local_function():\n    print("Running on local machine!")\n    return "local-mode"\n```' },
                    { name: 'dev.sh', type: 'file', content: '#!/bin/bash\n# ç«¯ä¾§å¼€å‘è„šæœ¬\necho "Starting local development..."\nnpm install\nnpm run dev' },
                    { name: 'config.yaml', type: 'file', content: '# ç«¯ä¾§é…ç½®\nmode: local\nhost: localhost\nport: 3001\nenv: development' }
                ];
            }
            
            renderFileList();
            document.getElementById('currentWorkspace').textContent = currentMode === 'cloud' ? 'powerautomation_web' : 'local_project';
        }

        // åˆå§‹åŒ–æ–‡ä»¶æµè§ˆå™¨
        function initializeFileExplorer() {
            loadEnvironmentFiles();
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            currentFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center p-2 hover:bg-gray-700 rounded cursor-pointer file-item';
                
                const icon = file.type === 'folder' ? 'ğŸ“' : (file.name.endsWith('.py') ? 'ğŸ' : (file.name.endsWith('.md') ? 'ğŸ“„' : (file.name.endsWith('.sh') ? 'âš¡' : 'âš™ï¸')));
                
                fileItem.innerHTML = `
                    <span class="mr-2">${icon}</span>
                    <span>${file.name}</span>
                    <span class="ml-auto text-xs text-gray-400">${file.type === 'folder' ? file.children?.length || 0 : Math.floor(Math.random() * 10) + 1}</span>
                `;
                
                if (file.type === 'file') {
                    fileItem.addEventListener('click', () => openFile(file));
                }
                
                fileList.appendChild(fileItem);
            });
        }

        // æ‰“å¼€æ–‡ä»¶
        function openFile(file) {
            if (monacoEditor && file.content) {
                // åˆ‡æ¢åˆ°Composeræ ‡ç­¾
                switchTab('composer');
                
                // è®¾ç½®ç¼–è¾‘å™¨å†…å®¹
                monacoEditor.setValue(file.content);
                
                // è®¾ç½®è¯­è¨€æ¨¡å¼
                const language = getLanguageFromFileName(file.name);
                monaco.editor.setModelLanguage(monacoEditor.getModel(), language);
                
                // æ›´æ–°å½“å‰æ–‡ä»¶æ˜¾ç¤º
                document.getElementById('currentFile').textContent = file.name;
                
                // é«˜äº®é€‰ä¸­çš„æ–‡ä»¶
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');
                
                console.log('å·²æ‰“å¼€æ–‡ä»¶:', file.name);
            }
        }

        // æ ¹æ®æ–‡ä»¶åè·å–è¯­è¨€
        function getLanguageFromFileName(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const languageMap = {
                'py': 'python',
                'js': 'javascript',
                'ts': 'typescript',
                'html': 'html',
                'css': 'css',
                'json': 'json',
                'md': 'markdown',
                'yaml': 'yaml',
                'yml': 'yaml',
                'sh': 'shell'
            };
            return languageMap[ext] || 'plaintext';
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-700', 'text-gray-300');
            });
            const targetBtn = document.querySelector(`[data-tab="${tabId}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active', 'bg-blue-600', 'text-white');
                targetBtn.classList.remove('bg-gray-700', 'text-gray-300');
            }
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
                targetContent.style.display = 'block';
            }
        }

        // æ›´æ–°ç»ˆç«¯æ¨¡å¼
        function updateTerminalMode() {
            const terminalPrompt = document.getElementById('terminalPrompt');
            const inputPrompt = document.getElementById('inputPrompt');
            
            if (currentMode === 'cloud') {
                terminalPrompt.textContent = 'ec2-user@smartui:~$';
                inputPrompt.textContent = '$';
            } else {
                // æ£€æµ‹æ“ä½œç³»ç»Ÿ
                const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                const isWindows = navigator.platform.toUpperCase().indexOf('WIN') >= 0;
                
                if (isMac) {
                    terminalPrompt.textContent = 'alexchuang@MacBook:~$';
                } else if (isWindows) {
                    terminalPrompt.textContent = 'alexchuang@WSL:~$';
                } else {
                    terminalPrompt.textContent = 'user@local:~$';
                }
                inputPrompt.textContent = '$';
            }
        }

        // æ›´æ–°å·¥ä½œåŒºè·¯å¾„
        function updateWorkspacePath() {
            const workspacePath = document.getElementById('workspacePath');
            if (currentMode === 'cloud') {
                currentWorkspace = '/home/ec2-user/powerautomation_web';
            } else {
                currentWorkspace = '/Users/alexchuang/powerautomation_web';
            }
            workspacePath.textContent = currentWorkspace;
        }

        // ä¿å­˜æ–‡ä»¶
        function saveFile() {
            if (monacoEditor) {
                const content = monacoEditor.getValue();
                const fileName = document.getElementById('currentFile').textContent;
                
                // æ¨¡æ‹Ÿä¿å­˜æ“ä½œ
                console.log('ä¿å­˜æ–‡ä»¶:', fileName, 'å†…å®¹é•¿åº¦:', content.length);
                addTerminalOutput(`ä¿å­˜æ–‡ä»¶: ${fileName} (${currentMode === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'})`);
                
                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.classList.add('success-flash');
                saveBtn.textContent = 'å·²ä¿å­˜';
                
                setTimeout(() => {
                    saveBtn.classList.remove('success-flash');
                    saveBtn.textContent = 'ä¿å­˜æ–‡ä»¶';
                }, 1000);
            }
        }

        // æ ¼å¼åŒ–ä»£ç 
        function formatCode() {
            if (monacoEditor) {
                monacoEditor.getAction('editor.action.formatDocument').run();
                
                // æ˜¾ç¤ºæ ¼å¼åŒ–æˆåŠŸæç¤º
                const formatBtn = document.getElementById('formatBtn');
                formatBtn.classList.add('success-flash');
                formatBtn.textContent = 'å·²æ ¼å¼åŒ–';
                
                setTimeout(() => {
                    formatBtn.classList.remove('success-flash');
                    formatBtn.textContent = 'æ ¼å¼åŒ–ä»£ç ';
                }, 1000);
            }
        }

        // åˆ‡æ¢å°åœ°å›¾
        function toggleMinimap() {
            if (monacoEditor) {
                const minimapEnabled = monacoEditor.getOptions().get(monaco.editor.EditorOption.minimap).enabled;
                monacoEditor.updateOptions({
                    minimap: { enabled: !minimapEnabled }
                });
                
                const minimapBtn = document.getElementById('minimapBtn');
                minimapBtn.textContent = minimapEnabled ? 'ğŸ—ºï¸ æ˜¾ç¤ºå°åœ°å›¾' : 'ğŸ—ºï¸ éšè—å°åœ°å›¾';
            }
        }

        // æ‰“å¼€æŸ¥æ‰¾æ›¿æ¢
        function openFindReplace() {
            if (monacoEditor) {
                monacoEditor.getAction('editor.action.startFindReplaceAction').run();
            }
        }

        // æ˜¾ç¤ºå…‹éš†ä»“åº“æ¨¡æ€æ¡†
        function showCloneModal() {
            document.getElementById('cloneModal').style.display = 'block';
        }

        // æ˜¾ç¤ºæ‰“å¼€æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
        function showFolderModal() {
            document.getElementById('folderModal').style.display = 'block';
        }

        // è®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶
        function setupModalEvents() {
            // å…‹éš†ä»“åº“æ¨¡æ€æ¡†
            document.getElementById('closeCloneModal').addEventListener('click', () => {
                document.getElementById('cloneModal').style.display = 'none';
            });
            
            document.getElementById('cancelClone').addEventListener('click', () => {
                document.getElementById('cloneModal').style.display = 'none';
            });
            
            document.getElementById('confirmClone').addEventListener('click', () => {
                const repoUrl = document.getElementById('repoUrl').value;
                const localDir = document.getElementById('localDir').value;
                
                if (repoUrl && localDir) {
                    cloneRepository(repoUrl, localDir);
                    document.getElementById('cloneModal').style.display = 'none';
                    document.getElementById('repoUrl').value = '';
                    document.getElementById('localDir').value = '';
                }
            });

            // æ‰“å¼€æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
            document.getElementById('closeFolderModal').addEventListener('click', () => {
                document.getElementById('folderModal').style.display = 'none';
            });
            
            document.getElementById('cancelFolder').addEventListener('click', () => {
                document.getElementById('folderModal').style.display = 'none';
            });
            
            document.getElementById('confirmFolder').addEventListener('click', () => {
                const folderPath = document.getElementById('folderPath').value;
                
                if (folderPath) {
                    openFolder(folderPath);
                    document.getElementById('folderModal').style.display = 'none';
                    document.getElementById('folderPath').value = '';
                }
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        // å…‹éš†ä»“åº“
        async function cloneRepository(repoUrl, localDir) {
            console.log('å…‹éš†ä»“åº“:', repoUrl, 'åˆ°ç›®å½•:', localDir);
            
            addTerminalOutput(`æ­£åœ¨å…‹éš†ä»“åº“ ${repoUrl} åˆ° ${localDir}...`);
            addTerminalOutput(`ä½¿ç”¨${currentMode === 'cloud' ? 'äº‘ä¾§EC2' : 'ç«¯ä¾§æœ¬åœ°'}ç¯å¢ƒ`);
            
            try {
                // è°ƒç”¨çœŸå®çš„åç«¯APIè¿›è¡Œå…‹éš†
                const response = await fetch('http://18.212.49.136:5002/api/clone-repo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        repo_url: repoUrl,
                        local_dir: localDir
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addTerminalOutput(`âœ… å…‹éš†å®Œæˆï¼`);
                    addTerminalOutput(`é¡¹ç›®å·²ä¿å­˜åˆ°: ${result.path}`);
                    
                    // æ›´æ–°å½“å‰å·¥ä½œåŒº
                    currentWorkspace = result.path;
                    document.getElementById('workspacePath').textContent = currentWorkspace;
                    
                    // è·å–é¡¹ç›®ä¿¡æ¯å¹¶æ›´æ–°ç•Œé¢
                    await updateProjectInfo(result.path);
                    
                    // åŠ è½½é¡¹ç›®æ–‡ä»¶æ ‘
                    await loadProjectFiles(result.path);
                    
                } else {
                    addTerminalOutput(`âŒ å…‹éš†å¤±è´¥: ${result.error}`);
                }
                
            } catch (error) {
                console.error('å…‹éš†ä»“åº“å¤±è´¥:', error);
                addTerminalOutput(`âŒ å…‹éš†å¤±è´¥: ${error.message}`);
            }
        }

        // æ›´æ–°é¡¹ç›®ä¿¡æ¯
        async function updateProjectInfo(projectPath) {
            try {
                const response = await fetch('http://18.212.49.136:5002/api/get-project-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ path: projectPath })
                });
                
                const projectInfo = await response.json();
                
                if (projectInfo.name) {
                    // æ›´æ–°å³ä¸Šè§’é¡¹ç›®ä¿¡æ¯ - å°è¯•å¤šä¸ªå¯èƒ½çš„å…ƒç´ 
                    const projectElements = [
                        document.querySelector('.project-name'),
                        document.getElementById('currentWorkspace'),
                        document.querySelector('[class*="project"]'),
                        document.querySelector('.workspace-path'),
                        document.getElementById('workspacePath')
                    ];
                    
                    projectElements.forEach(element => {
                        if (element) {
                            if (element.classList.contains('workspace-path')) {
                                element.textContent = `å·¥ä½œåŒº: ${projectPath}`;
                            } else {
                                element.textContent = projectInfo.name;
                            }
                        }
                    });
                    
                    // æ›´æ–°é¡µé¢æ ‡é¢˜
                    document.title = `SmartUI - ${projectInfo.name}`;
                    
                    // æ›´æ–°é¡¹ç›®ç±»å‹å’Œæè¿°
                    console.log('é¡¹ç›®ä¿¡æ¯:', projectInfo);
                    addTerminalOutput(`é¡¹ç›®åç§°: ${projectInfo.name}`);
                    addTerminalOutput(`é¡¹ç›®ç±»å‹: ${projectInfo.type}`);
                    if (projectInfo.description) {
                        addTerminalOutput(`é¡¹ç›®æè¿°: ${projectInfo.description}`);
                    }
                    if (projectInfo.version) {
                        addTerminalOutput(`é¡¹ç›®ç‰ˆæœ¬: ${projectInfo.version}`);
                    }
                    if (projectInfo.git_url) {
                        addTerminalOutput(`Gitä»“åº“: ${projectInfo.git_url}`);
                    }
                    addTerminalOutput(`æ–‡ä»¶æ•°é‡: ${projectInfo.file_count}, æ–‡ä»¶å¤¹æ•°é‡: ${projectInfo.folder_count}`);
                    
                    // å°è¯•æ›´æ–°å³ä¸Šè§’çš„é¡¹ç›®ç®¡ç†åŒºåŸŸ
                    const projectManagementArea = document.querySelector('.project-management') || 
                                                 document.querySelector('[class*="ç®¡ç†"]');
                    if (projectManagementArea) {
                        projectManagementArea.innerHTML = `
                            <div class="project-info">
                                <h3>${projectInfo.name}</h3>
                                <p>ç±»å‹: ${projectInfo.type}</p>
                                ${projectInfo.description ? `<p>${projectInfo.description}</p>` : ''}
                            </div>
                        `;
                    }
                }
                
            } catch (error) {
                console.error('è·å–é¡¹ç›®ä¿¡æ¯å¤±è´¥:', error);
                addTerminalOutput(`è·å–é¡¹ç›®ä¿¡æ¯å¤±è´¥: ${error.message}`);
            }
        }

        // åŠ è½½é¡¹ç›®æ–‡ä»¶
        async function loadProjectFiles(projectPath) {
            try {
                const response = await fetch('http://18.212.49.136:5002/api/get-file-tree', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        path: projectPath,
                        max_depth: 3
                    })
                });
                
                const result = await response.json();
                
                if (result.tree) {
                    // æ›´æ–°å·¦ä¾§æ–‡ä»¶èµ„æºç®¡ç†å™¨
                    currentFiles = result.tree;
                    renderFileList();
                    addTerminalOutput(`å·²åŠ è½½ ${result.tree.length} ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹`);
                }
                
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®æ–‡ä»¶å¤±è´¥:', error);
                addTerminalOutput(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${error.message}`);
            }
        }
                renderFileList();
                
                // æ›´æ–°å½“å‰å·¥ä½œåŒº
                document.getElementById('currentWorkspace').textContent = localDir;
            }, 2000);
        }

        // æ‰“å¼€æ–‡ä»¶å¤¹
        async function openFolder(folderPath) {
            console.log('æ‰“å¼€æ–‡ä»¶å¤¹:', folderPath);
            
            addTerminalOutput(`æ­£åœ¨æ‰“å¼€æ–‡ä»¶å¤¹ ${folderPath}...`);
            addTerminalOutput(`ä½¿ç”¨${currentMode === 'cloud' ? 'äº‘ä¾§EC2' : 'ç«¯ä¾§æœ¬åœ°'}ç¯å¢ƒ`);
            
            try {
                // æ›´æ–°å½“å‰å·¥ä½œåŒº
                currentWorkspace = folderPath;
                document.getElementById('workspacePath').textContent = currentWorkspace;
                
                // è·å–é¡¹ç›®ä¿¡æ¯å¹¶æ›´æ–°ç•Œé¢
                await updateProjectInfo(folderPath);
                
                // åŠ è½½é¡¹ç›®æ–‡ä»¶æ ‘
                await loadProjectFiles(folderPath);
                
                addTerminalOutput(`âœ… æ–‡ä»¶å¤¹å·²æ‰“å¼€ï¼`);
                addTerminalOutput(`å½“å‰å·¥ä½œç›®å½•: ${folderPath}`);
                
            } catch (error) {
                console.error('æ‰“å¼€æ–‡ä»¶å¤¹å¤±è´¥:', error);
                addTerminalOutput(`âŒ æ‰“å¼€æ–‡ä»¶å¤¹å¤±è´¥: ${error.message}`);
            }
        }

        // æ‰§è¡Œç»ˆç«¯å‘½ä»¤
        function executeTerminalCommand(command) {
            if (!command.trim()) return;
            
            const prompt = currentMode === 'cloud' ? 'ec2-user@smartui:~$' : 
                          (navigator.platform.toUpperCase().indexOf('MAC') >= 0 ? 'alexchuang@MacBook:~$' : 'alexchuang@WSL:~$');
            
            addTerminalOutput(`${prompt} ${command}`);
            
            // ç«‹å³å¤„ç†æŸäº›å‘½ä»¤ï¼Œé¿å…å»¶è¿Ÿ
            if (command.toLowerCase() === 'clear') {
                document.getElementById('terminalOutput').innerHTML = '';
                return;
            }
            
            // æ¨¡æ‹Ÿå‘½ä»¤æ‰§è¡Œï¼Œå‡å°‘å»¶è¿Ÿ
            setTimeout(() => {
                let output = '';
                
                switch (command.toLowerCase().trim()) {
                    case 'ls':
                    case 'dir':
                        output = currentFiles.map(f => f.name).join('  ');
                        break;
                    case 'pwd':
                        output = currentWorkspace;
                        break;
                    case 'whoami':
                        output = currentMode === 'cloud' ? 'ec2-user' : 'alexchuang';
                        break;
                    case 'date':
                        output = new Date().toString();
                        break;
                    case 'env':
                        output = `MODE=${currentMode}\nWORKSPACE=${currentWorkspace}\nSSH_TUNNEL=${sshTunnelConnected ? 'connected' : 'disconnected'}`;
                        break;
                    case 'cd ..':
                        // å¤„ç†è¿”å›ä¸Šçº§ç›®å½•
                        const pathParts = currentWorkspace.split('/');
                        if (pathParts.length > 1) {
                            pathParts.pop();
                            currentWorkspace = pathParts.join('/') || '/';
                            document.getElementById('workspacePath').textContent = currentWorkspace;
                            output = `åˆ‡æ¢åˆ°ç›®å½•: ${currentWorkspace}`;
                        } else {
                            output = 'å·²åœ¨æ ¹ç›®å½•';
                        }
                        break;
                    case 'cd ~':
                        // å¤„ç†è¿”å›ä¸»ç›®å½•
                        currentWorkspace = currentMode === 'cloud' ? '/home/ec2-user' : '/Users/alexchuang';
                        document.getElementById('workspacePath').textContent = currentWorkspace;
                        output = `åˆ‡æ¢åˆ°ä¸»ç›®å½•: ${currentWorkspace}`;
                        break;
                    default:
                        if (command.startsWith('cd ')) {
                            const targetDir = command.substring(3).trim();
                            if (targetDir) {
                                // å¤„ç†cdå‘½ä»¤
                                if (targetDir === '..') {
                                    const pathParts = currentWorkspace.split('/');
                                    if (pathParts.length > 1) {
                                        pathParts.pop();
                                        currentWorkspace = pathParts.join('/') || '/';
                                    }
                                } else if (targetDir === '~') {
                                    currentWorkspace = currentMode === 'cloud' ? '/home/ec2-user' : '/Users/alexchuang';
                                } else if (targetDir.startsWith('/')) {
                                    currentWorkspace = targetDir;
                                } else {
                                    currentWorkspace = currentWorkspace + '/' + targetDir;
                                }
                                document.getElementById('workspacePath').textContent = currentWorkspace;
                                output = `åˆ‡æ¢åˆ°ç›®å½•: ${currentWorkspace}`;
                            } else {
                                output = 'è¯·æŒ‡å®šç›®å½•';
                            }
                        } else if (command.startsWith('git ')) {
                            output = `æ‰§è¡ŒGitå‘½ä»¤: ${command} (${currentMode === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'})`;
                        } else if (command.startsWith('npm ') || command.startsWith('yarn ')) {
                            output = `æ‰§è¡ŒåŒ…ç®¡ç†å‘½ä»¤: ${command} (${currentMode === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'})`;
                        } else {
                            output = `å‘½ä»¤æ‰§è¡Œå®Œæˆ: ${command} (${currentMode === 'cloud' ? 'äº‘ä¾§EC2' : 'ç«¯ä¾§æœ¬åœ°'})`;
                        }
                }
                
                if (output) {
                    addTerminalOutput(output);
                }
                
                // æ˜¾ç¤ºæ–°çš„æç¤ºç¬¦
                setTimeout(() => {
                    const newPrompt = currentMode === 'cloud' ? 'ec2-user@smartui:~$' : 
                                    (navigator.platform.toUpperCase().indexOf('MAC') >= 0 ? 'alexchuang@MacBook:~$' : 'alexchuang@WSL:~$');
                    addTerminalOutput(newPrompt + ' ');
                }, 100);
                
            }, 200); // å‡å°‘å»¶è¿Ÿæ—¶é—´
        }

        // æ·»åŠ ç»ˆç«¯è¾“å‡º
        function addTerminalOutput(text) {
            const output = document.getElementById('terminalOutput');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
    </script>
</body>
</html>


        // æ–‡ä»¶å¤¹æµè§ˆå™¨ç›¸å…³å‡½æ•°
        let currentBrowsePath = '/home/ec2-user';
        let selectedFolderPath = '';

        // åŠ è½½æ–‡ä»¶å¤¹å†…å®¹
        async function loadFolderContents(path) {
            currentBrowsePath = path;
            document.getElementById('currentPath').value = path;
            
            const browser = document.getElementById('folderBrowser');
            browser.innerHTML = '<div class="text-gray-400 text-center py-8">åŠ è½½ä¸­...</div>';
            
            // è·å–çœŸå®æ–‡ä»¶å¤¹å†…å®¹
            try {
                const folders = await getRealFolders(path);
                displayFolders(folders);
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥:', error);
                browser.innerHTML = '<div class="text-red-400 text-center py-8">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }

        // è·å–çœŸå®æ–‡ä»¶å¤¹æ•°æ®
        async function getRealFolders(path) {
            try {
                const response = await fetch('http://18.212.49.136:5002/api/browse-folder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ path: path })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.items || [];
            } catch (error) {
                console.error('è·å–æ–‡ä»¶å¤¹å†…å®¹å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œè¿”å›ç©ºæ•°ç»„
                return [];
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶å¤¹åˆ—è¡¨
        function displayFolders(folders) {
            const browser = document.getElementById('folderBrowser');
            browser.innerHTML = '';
            
            folders.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.className = 'folder-item flex items-center gap-2 p-2 hover:bg-gray-700 cursor-pointer rounded';
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒå›¾æ ‡
                const icon = folder.type === 'folder' ? 'ğŸ“' : 'ğŸ“„';
                const iconColor = folder.type === 'folder' ? 'text-blue-400' : 'text-green-400';
                
                folderItem.innerHTML = `
                    <span class="${iconColor}">${icon}</span>
                    <span class="flex-1">${folder.name}</span>
                    <span class="text-xs text-gray-500">${folder.type}</span>
                `;
                
                folderItem.addEventListener('click', function() {
                    selectFolder(folder.path, folderItem, folder.type);
                });
                
                // åªæœ‰æ–‡ä»¶å¤¹å¯ä»¥åŒå‡»è¿›å…¥
                if (folder.type === 'folder') {
                    folderItem.addEventListener('dblclick', function() {
                        loadFolderContents(folder.path);
                    });
                }
                
                browser.appendChild(folderItem);
            });
        }

        // é€‰æ‹©æ–‡ä»¶å¤¹
        function selectFolder(path, element, type) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('bg-blue-600');
            });
            
            // é«˜äº®å½“å‰é€‰æ‹©
            element.classList.add('bg-blue-600');
            
            // æ›´æ–°é€‰ä¸­çš„æ–‡ä»¶å¤¹
            selectedFolderPath = path;
            document.getElementById('selectedFolder').value = path;
            
            // åªæœ‰é€‰æ‹©æ–‡ä»¶å¤¹æ—¶æ‰èƒ½ç¡®è®¤
            const confirmBtn = document.getElementById('confirmFolder');
            if (type === 'folder') {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'é€‰æ‹©æ­¤æ–‡ä»¶å¤¹';
            } else {
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'è¯·é€‰æ‹©æ–‡ä»¶å¤¹';
            }
        }

        // ä¸Šçº§ç›®å½•
        function goUpDirectory() {
            const pathParts = currentBrowsePath.split('/').filter(part => part);
            if (pathParts.length > 1) {
                pathParts.pop();
                const parentPath = '/' + pathParts.join('/');
                loadFolderContents(parentPath);
            } else if (currentBrowsePath !== '/') {
                loadFolderContents('/');
            }
        }

        // åˆ·æ–°å½“å‰ç›®å½•
        function refreshCurrentDirectory() {
            loadFolderContents(currentBrowsePath);
        }

        // æ‰“å¼€é€‰ä¸­çš„æ–‡ä»¶å¤¹
        function openSelectedFolder() {
            if (selectedFolderPath) {
                currentWorkspace = selectedFolderPath;
                document.getElementById('folderModal').style.display = 'none';
                
                // æ›´æ–°å·¥ä½œåŒºæ˜¾ç¤º
                document.querySelector('.workspace-path').textContent = `å·¥ä½œåŒº: ${selectedFolderPath}`;
                
                // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                initializeFileExplorer();
                
                console.log('å·²æ‰“å¼€æ–‡ä»¶å¤¹:', selectedFolderPath);
                alert(`å·²æ‰“å¼€æ–‡ä»¶å¤¹: ${selectedFolderPath}`);
            }
        }

        // å…‹éš†ä»“åº“å‡½æ•°
        function cloneRepository() {
            const repoUrl = document.getElementById('repoUrl').value;
            const localDir = document.getElementById('localDir').value;
            
            if (repoUrl && localDir) {
                document.getElementById('cloneModal').style.display = 'none';
                
                // æ¨¡æ‹Ÿå…‹éš†è¿‡ç¨‹
                console.log('æ­£åœ¨å…‹éš†ä»“åº“:', repoUrl, 'åˆ°ç›®å½•:', localDir);
                alert(`æ­£åœ¨å…‹éš†ä»“åº“ ${repoUrl} åˆ° ${localDir} ç›®å½•...`);
                
                // æ›´æ–°å·¥ä½œåŒº
                setTimeout(() => {
                    currentWorkspace = `/home/ec2-user/${localDir}`;
                    document.querySelector('.workspace-path').textContent = `å·¥ä½œåŒº: ${currentWorkspace}`;
                    initializeFileExplorer();
                    alert('ä»“åº“å…‹éš†å®Œæˆï¼');
                }, 2000);
            }
        }


        // ============================================================================
        // WebSocket ç»ˆç«¯è¿æ¥åŠŸèƒ½
        // ============================================================================
        
        // æ·»åŠ Socket.IOå®¢æˆ·ç«¯
        const script = document.createElement('script');
        script.src = 'https://cdn.socket.io/4.7.2/socket.io.min.js';
        document.head.appendChild(script);
        
        // ç»ˆç«¯WebSocketè¿æ¥
        let terminalSocket = null;
        let currentTerminalSession = null;
        let currentEnvironment = 'cloud'; // 'cloud' or 'local'
        
        // åˆå§‹åŒ–ç»ˆç«¯WebSocketè¿æ¥
        function initializeTerminalWebSocket() {
            // ç­‰å¾…Socket.IOåŠ è½½å®Œæˆ
            setTimeout(() => {
                if (typeof io !== 'undefined') {
                    // è¿æ¥åˆ°åç«¯WebSocketç»ˆç«¯æœåŠ¡
                    terminalSocket = io('http://localhost:8080');
                    
                    terminalSocket.on('connect', function() {
                        console.log('ç»ˆç«¯WebSocketè¿æ¥æˆåŠŸ');
                        updateTerminalStatus('å·²è¿æ¥', 'green');
                    });
                    
                    terminalSocket.on('disconnect', function() {
                        console.log('ç»ˆç«¯WebSocketè¿æ¥æ–­å¼€');
                        updateTerminalStatus('å·²æ–­å¼€', 'red');
                    });
                    
                    terminalSocket.on('terminal_started', function(data) {
                        console.log('ç»ˆç«¯ä¼šè¯å¯åŠ¨:', data);
                        currentTerminalSession = data.session_id;
                        updateTerminalPrompt(data.environment);
                    });
                    
                    terminalSocket.on('terminal_output', function(data) {
                        if (data.session_id === currentTerminalSession) {
                            appendTerminalOutput(data.data);
                        }
                    });
                    
                    terminalSocket.on('terminal_error', function(data) {
                        console.error('ç»ˆç«¯é”™è¯¯:', data.message);
                        appendTerminalOutput(`é”™è¯¯: ${data.message}\n`);
                    });
                    
                    terminalSocket.on('terminal_closed', function(data) {
                        console.log('ç»ˆç«¯ä¼šè¯å…³é—­:', data.session_id);
                        if (data.session_id === currentTerminalSession) {
                            currentTerminalSession = null;
                            appendTerminalOutput('ç»ˆç«¯ä¼šè¯å·²å…³é—­\n');
                        }
                    });
                } else {
                    console.error('Socket.IOæœªåŠ è½½ï¼Œé‡è¯•ä¸­...');
                    setTimeout(initializeTerminalWebSocket, 1000);
                }
            }, 1000);
        }
        
        // å¯åŠ¨ç»ˆç«¯ä¼šè¯
        function startTerminalSession(environment = 'cloud') {
            if (terminalSocket && terminalSocket.connected) {
                currentEnvironment = environment;
                terminalSocket.emit('start_terminal', {
                    environment: environment
                });
                
                // æ¸…ç©ºç»ˆç«¯è¾“å‡º
                document.getElementById('terminalOutput').innerHTML = '';
                appendTerminalOutput(`æ­£åœ¨å¯åŠ¨${environment === 'cloud' ? 'äº‘ä¾§' : 'ç«¯ä¾§'}ç»ˆç«¯...\n`);
            } else {
                console.error('ç»ˆç«¯WebSocketæœªè¿æ¥');
                appendTerminalOutput('é”™è¯¯: ç»ˆç«¯æœåŠ¡æœªè¿æ¥\n');
            }
        }
        
        // å‘é€ç»ˆç«¯è¾“å…¥
        function sendTerminalInput(input) {
            if (terminalSocket && currentTerminalSession) {
                terminalSocket.emit('terminal_input', {
                    session_id: currentTerminalSession,
                    data: input
                });
            }
        }
        
        // æ·»åŠ ç»ˆç«¯è¾“å‡º
        function appendTerminalOutput(output) {
            const terminalOutput = document.getElementById('terminalOutput');
            if (terminalOutput) {
                // è½¬ä¹‰HTMLå¹¶ä¿æŒæ ¼å¼
                const escapedOutput = output
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/\n/g, '<br>')
                    .replace(/ /g, '&nbsp;');
                
                terminalOutput.innerHTML += escapedOutput;
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
        }
        
        // æ›´æ–°ç»ˆç«¯çŠ¶æ€
        function updateTerminalStatus(status, color) {
            const statusElement = document.getElementById('terminalStatus');
            const indicatorElement = document.getElementById('terminalIndicator');
            
            if (statusElement) {
                statusElement.textContent = status;
            }
            
            if (indicatorElement) {
                indicatorElement.className = `w-2 h-2 bg-${color}-400 rounded-full`;
            }
        }
        
        // æ›´æ–°ç»ˆç«¯æç¤ºç¬¦
        function updateTerminalPrompt(environment) {
            const promptElement = document.getElementById('terminalPrompt');
            const inputPromptElement = document.getElementById('inputPrompt');
            
            if (environment === 'cloud') {
                const cloudPrompt = 'ec2-user@smartui:~$';
                if (promptElement) promptElement.textContent = cloudPrompt;
                if (inputPromptElement) inputPromptElement.textContent = '$';
            } else {
                const localPrompt = 'alexchuang@MacBook:~$';
                if (promptElement) promptElement.textContent = localPrompt;
                if (inputPromptElement) inputPromptElement.textContent = '$';
            }
        }
        
        // ä¿®æ”¹åŸæœ‰çš„ç»ˆç«¯è¾“å…¥å¤„ç†
        function handleTerminalInput() {
            const terminalInput = document.getElementById('terminalInput');
            if (terminalInput) {
                terminalInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const command = this.value;
                        if (command.trim()) {
                            // æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
                            const prompt = currentEnvironment === 'cloud' ? 'ec2-user@smartui:~$' : 'alexchuang@MacBook:~$';
                            appendTerminalOutput(`${prompt} ${command}\n`);
                            
                            // å‘é€åˆ°çœŸå®ç»ˆç«¯
                            sendTerminalInput(command + '\n');
                            
                            // æ¸…ç©ºè¾“å…¥æ¡†
                            this.value = '';
                        }
                    }
                });
            }
        }
        
        // ç¯å¢ƒåˆ‡æ¢å¤„ç†
        function handleEnvironmentSwitch() {
            const deployModeToggle = document.getElementById('deployModeToggle');
            if (deployModeToggle) {
                deployModeToggle.addEventListener('click', function() {
                    const isActive = this.classList.contains('active');
                    const newEnvironment = isActive ? 'local' : 'cloud';
                    
                    // å…³é—­å½“å‰ç»ˆç«¯ä¼šè¯
                    if (terminalSocket && currentTerminalSession) {
                        terminalSocket.emit('close_terminal', {
                            session_id: currentTerminalSession
                        });
                    }
                    
                    // å¯åŠ¨æ–°ç¯å¢ƒçš„ç»ˆç«¯ä¼šè¯
                    setTimeout(() => {
                        startTerminalSession(newEnvironment);
                    }, 500);
                });
            }
        }
        
        // ä¿®æ”¹åŸæœ‰çš„åˆå§‹åŒ–å‡½æ•°
        const originalInitialize = window.onload;
        window.onload = function() {
            if (originalInitialize) originalInitialize();
            
            // åˆå§‹åŒ–WebSocketç»ˆç«¯
            initializeTerminalWebSocket();
            
            // ç»‘å®šç»ˆç«¯è¾“å…¥äº‹ä»¶
            handleTerminalInput();
            
            // ç»‘å®šç¯å¢ƒåˆ‡æ¢äº‹ä»¶
            handleEnvironmentSwitch();
            
            // å½“åˆ‡æ¢åˆ°ç»ˆç«¯æ ‡ç­¾é¡µæ—¶å¯åŠ¨ç»ˆç«¯ä¼šè¯
            const terminalTab = document.querySelector('[data-tab="terminal"]');
            if (terminalTab) {
                terminalTab.addEventListener('click', function() {
                    setTimeout(() => {
                        if (!currentTerminalSession) {
                            startTerminalSession(currentEnvironment);
                        }
                    }, 100);
                });
            }
        };
    </script>
</body>
</html>

